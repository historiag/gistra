<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Forge Crafting Calculator - Roblox bahLiL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #f44c5f;
            --primary-dark: #281508;
            --primary-light: rgba(255, 102, 0, 0.1);
            --primary-glow: rgba(255, 102, 0, 0.2);
            --background: #0f0f0f;
            --card-bg: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --text: #f0f0f0;
            --text-secondary: #f5f5f5;
            --border: #444;
            --success: #4CAF50;
            --warning: #ff9800;
            --error: #f44336;
            --glow: 0 0 15px rgba(255, 102, 0, 0.4);
            --common: #8c8c8c;
            --uncommon: #4CAF50;
            --rare: #2196F3;
            --epic: #9c27b0;
            --legendary: #f0b209;
            --mythical: #d13429;
            --relic: #ffeb3b;
            --stonewake-teal: #0a6e6e;
            --animation-speed: 0.3s;
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text);
            max-width: 840px;
            margin: 0 auto;
            padding: 10px;
            line-height: 1.6;
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 20% 80%, var(--primary-light) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, var(--primary-light) 0%, transparent 50%);
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            opacity: 0.98;
        }

        /* Header & Mode Toggle */
        header {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--border-radius);
            box-shadow: var(--glow);
            position: relative;
            overflow: hidden;
            animation: slideDown 0.5s ease-out;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shimmer 3s infinite;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            display: inline-block;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 25%;
            width: 50%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        /* Buttons */
        button {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all var(--animation-speed) cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: none;
            cursor: pointer;
            outline: none;
        }

        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        .toggle-btn {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.8);
            color: var(--text);
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.95rem;
            border: 2px solid var(--border);
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, var(--text-secondary), var(--primary-dark));
            border-color: rgba(255, 255, 255, 0.2);
        }

        .toggle-btn:hover:not(.active) {
            box-shadow: 0px 6px 20px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--primary);
            transform: translateY(-3px);
        }

        /* Quick Craft Button */
        .quick-craft-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 25px;
            font-weight: 600;
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            justify-content: center;
        }

        .quick-craft-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px var(--primary-glow);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn var(--animation-speed) ease-out;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--card-shadow);
            border: 2px solid var(--primary-dark);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center center;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-dark);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.6rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all var(--animation-speed);
            position: relative;
        }

        .modal-close:hover {
            background: var(--primary-dark);
            transform: rotate(90deg);
        }

        .modal-step {
            margin-bottom: 15px;
            display: none;
        }

        .modal-step.active {
            display: block;
        }

        .modal-step-title {
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .modal-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .modal-option {
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 2px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-option.selected {
            border-color: var(--primary);
            background-color: var(--primary-light);
        }

        .modal-option:hover {
            transform: translateY(-3px);
        }

        .trait-option.disabled {
            opacity: 0.4;
            filter: grayscale(0.7);
            pointer-events: none;
            cursor: not-allowed;
        }

        .modal-option.disabled {
            opacity: 0.4;
            filter: grayscale(0.7);
            pointer-events: none;
            cursor: not-allowed;
        }

        .trait-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            transform-origin: center;
        }

        .trait-option:hover {
            transform: translateY(-3px);
            border-color: var(--primary-light);
            background-color: var(--primary-light);
        }

        .trait-option.selected {
            border-color: var(--primary);
            background-color: var(--primary-light);
            box-shadow: 0 0 10px var(--primary-light);
        }

        .trait-option.selected:hover {
            background-color: var(--primary-light);
            border-color: var(--primary);
        }

        .trait-info {
            flex: 1;
            text-align: left;
        }

        .trait-name {
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--text);
        }

        .trait-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
            line-height: 1.4;
        }

        .modal-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            gap: 10px;
        }

        /* Sections */
        .inventory-section,
        .mix-section,
        .probability-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: fadeInUp 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .inventory-section::before,
        .mix-section::before,
        .probability-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), transparent);
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title i {
            margin-right: 6px;
        }

        /* Compact Filter & Search Container */
        .filter-search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Filters Dropdown */
        .filters-dropdown {
            position: relative;
        }

        .dropdown-toggle {
            padding: 10px 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all var(--animation-speed);
            white-space: nowrap;
        }

        .dropdown-toggle:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .dropdown-toggle.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary-glow);
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 5px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            min-width: 170px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border);
            z-index: 100;
            max-height: 250px;
            overflow-y: auto;
            animation: fadeIn 0.2s ease;
        }

        .dropdown-menu.show {
            display: block;
        }

        .filter-option {
            padding: 10px 15px;
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .filter-option:last-child {
            border-bottom: none;
        }

        .filter-option:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .filter-option.active {
            background: var(--primary-light);
            color: var(--primary);
            position: relative;
        }

        .dropdown-divider {
            height: 1px;
            background: var(--primary-dark);
        }

        /* Search Container */
        .search-container {
            flex: 1;
        }

        #ore-search {
            width: 100%;
            padding: 10px 10px 10px 35px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text);
            font-size: 0.85rem;
            outline: none;
            transition: all 0.3s ease;
        }

        #ore-search:focus {
            border-color: var(--primary-dark);
            box-shadow: 0 0 0 2px var(--primary-glow);
            background: rgba(0, 0, 0, 0.5);
        }

        #ore-search::placeholder {
            color: var(--text-secondary);
        }

        /* Ores Grid */
        .ores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            min-height: 240px;
            max-height: 240px;
            overflow-y: auto;
            padding: 10px;
        }

        .ore-item {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            aspect-ratio: 1/1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .ore-item:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--glow);
        }

        .ore-item.has-trait .trait-indicator {
            position: absolute;
            bottom: 9px;
            left: 9px;
            color: var(--text-secondary);
            font-size: 1rem;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .ore-item.has-trait .trait-indicator i {
            font-size: 1rem;
        }

        .ore-name {
            position: absolute;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.95rem;
            font-weight: bold;
            padding: 5px 5px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.8),
                -1px -1px 0 rgba(0, 0, 0, 0.5),
                1px -1px 0 rgba(0, 0, 0, 0.5),
                -1px 1px 0 rgba(0, 0, 0, 0.5),
                1px 1px 0 rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ore-multiplier {
            position: absolute;
            bottom: 8px;
            right: 8px;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1),
                -1px -1px 0 rgba(0, 0, 0, 0.5),
                1px -1px 0 rgba(0, 0, 0, 0.5),
                -1px 1px 0 rgba(0, 0, 0, 0.5),
                1px 1px 0 rgba(0, 0, 0, 0.5);
        }

        .ore-item.no-image {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            position: relative;
            overflow: hidden;
        }

        .ore-item.no-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg,
                    rgba(255, 255, 255, 0.03) 0%,
                    rgba(255, 255, 255, 0) 50%,
                    rgba(0, 0, 0, 0.1) 100%);
            z-index: 1;
        }

        .ore-item.no-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(45deg, rgba(255, 255, 255, 0.02) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.02) 50%, rgba(255, 255, 255, 0.02) 75%, transparent 75%, transparent);
            background-size: 8px 8px;
            z-index: 0;
        }

        .ore-item.no-image .ore-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            opacity: 0.7;
            z-index: 1;
        }

        .ore-item.no-image .ore-name {
            position: absolute;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.95rem;
            font-weight: bold;
            padding: 3px 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8),
                -1px -1px 0 rgba(0, 0, 0, 0.5),
                1px -1px 0 rgba(0, 0, 0, 0.5),
                -1px 1px 0 rgba(0, 0, 0, 0.5),
                1px 1px 0 rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 2;
        }

        .ore-item.no-image .ore-multiplier {
            position: absolute;
            bottom: 8px;
            right: 8px;
            color: white;
            font-size: 0.85rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8),
                -1px -1px 0 rgba(0, 0, 0, 0.5),
                1px -1px 0 rgba(0, 0, 0, 0.5),
                -1px 1px 0 rgba(0, 0, 0, 0.5),
                1px 1px 0 rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        /* Slots */
        .slots-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 15px;
            margin-left: 60px;
            margin-right: 60px;
        }

        .slot {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            text-align: center;
            border: 2px dashed var(--border);
            transition: all 0.3s;
            aspect-ratio: 1/1;
            position: relative;
            overflow: hidden;
        }

        .slot.filled {
            border: 2px solid var(--primary);
            background-color: var(--primary-light);
            transition: all 0.3s ease;
        }

        .slot.filled:hover {
            box-shadow: var(--glow);
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }

        .slot-placeholder {
            color: var(--border);
            font-size: 0.9rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .slot-ore {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .slot-ore-name {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 3px 5px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.8),
                -1px -1px 0 rgba(0, 0, 0, 0.5),
                1px -1px 0 rgba(0, 0, 0, 0.5),
                -1px 1px 0 rgba(0, 0, 0, 0.5),
                1px 1px 0 rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .slot-ore-count {
            position: absolute;
            bottom: 8px;
            right: 8px;
            color: white;
            font-size: 0.85rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8),
                -1px -1px 0 rgba(0, 0, 0, 0.5),
                1px -1px 0 rgba(0, 0, 0, 0.5),
                -1px 1px 0 rgba(0, 0, 0, 0.5),
                1px 1px 0 rgba(0, 0, 0, 0.5);
        }

        .slot-ore-percentage {
            position: absolute;
            bottom: 8px;
            left: 8px;
            color: white;
            font-size: 0.85rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8),
                -1px -1px 0 rgba(0, 0, 0, 0.5),
                1px -1px 0 rgba(0, 0, 0, 0.5),
                -1px 1px 0 rgba(0, 0, 0, 0.5),
                1px 1px 0 rgba(0, 0, 0, 0.5);
        }

        /* Stats & Traits */
        .stat-box {
            background: linear-gradient(135deg, var(--primary-light), rgba(0, 0, 0, 0.2));
            border-radius: var(--border-radius);
            padding: 5px;
            text-align: center;
            border: 1px solid var(--primary-light);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            border: 1px solid var(--primary);
            transition: all 0.3s ease;
        }

        .stat-title {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary-glow);
        }

        /* Traits Section */
        .traits-container {
            margin-top: 10px;
        }

        .traits-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .trait-card {
            background: var(--primary-light);
            border: 1px solid var(--primary);
            border-radius: var(--border-radius);
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all var(--animation-speed) ease;
            position: relative;
            overflow: hidden;
        }

        .trait-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-light), transparent);
            opacity: 0;
            transition: opacity var(--animation-speed) ease;
        }

        .trait-card:hover::before {
            opacity: 1;
        }

        .trait-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--glow);
        }

        .trait-content {
            flex: 1;
        }

        .trait-name {
            font-weight: bold;
            color: var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .trait-percentage {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 2px 8px;
            border-radius: var(--border-radius);
        }

        .trait-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Probability Section */
        .probability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .probability-item {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), var(--primary-light));
            border-radius: 10px;
            padding: 10px 15px;
            border: 2px solid var(--primary-light);
            border-left: 4px solid var(--primary);
            transition: all var(--animation-speed);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
        }

        .probability-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity var(--animation-speed) ease;
        }

        .probability-item:hover::before {
            opacity: 1;
        }

        .probability-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-name {
            font-weight: bold;
            font-size: 0.75rem;
            color: var(--text);
            flex: 1;
        }

        .optimal-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: var(--border-radius);
            font-weight: 600;
            white-space: nowrap;
            margin-left: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .probability-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 5px;
            position: relative;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--text-secondary));
            border-radius: 12px;
            position: relative;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            min-width: 0;
        }

        .probability-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .probability-value {
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .control-btn {
            padding: 10px 30px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s;
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .forge-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 6px 25px var(--primary-light);
        }

        .forge-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px var(--primary-glow);
        }

        .reset-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .reset-btn:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--primary);
        }

        /* Forge Result Modal */
        .forge-result-container {
            padding: 15px 10px;
            border-radius: var(--border-radius);
        }

        #forge-result-content {
            max-width: 700px;
            animation: modalSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .forge-result-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .forge-result-image {
            width: 140px;
            height: 105px;
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            border: 3px solid;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .forge-result-details {
            flex: 1;
            min-width: 250px;
        }

        .forge-result-name {
            font-size: 1.4rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .forge-result-type {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }

        .forge-result-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .forge-tag {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid var(--primary-dark);
            text-shadow: 0px 0px 4px rgba(0, 0, 0, 0.6);
        }

        .forge-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .forge-stat-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid var(--primary-light);
            text-align: center;
            transition: all var(--animation-speed) ease;
        }

        .forge-stat-item:hover {
            background: rgba(0, 0, 0, 0.05);
            border-color: var(--primary);
            box-shadow: var(--glow);
            transform: translateY(-3px);
            transition: all var(--animation-speed) ease;
        }

        .forge-stat-label {
            color: var(--text);
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .forge-stat-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
        }

        .traits-section {
            margin-top: 10px;
        }

        .traits-list-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }

        .trait-placeholder {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .forge-trait-item {
            background: var(--primary-light);
            border: 1px solid var(--primary-light);
            border-radius: 10px;
            padding: 5px 10px;
            transition: all var(--animation-speed);
        }

        .forge-trait-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow);
        }

        .forge-trait-ore {
            font-weight: bold;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            gap: 6px;
            text-shadow: 0px 0px 4px rgba(0, 0, 0, 0.6);
        }

        .forge-trait-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Area Toggle */
        #area-toggle-btn {
            font-size: 0.8rem;
            padding: 5px 12px;
            border-radius: 15px;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            transition: all var(--animation-speed);
        }

        #area-toggle-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .area-option {
            padding: 10px 15px;
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .area-option:last-child {
            border-bottom: none;
        }

        .area-option:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .area-option.active {
            background: var(--primary-light);
            color: var(--primary);
            position: relative;
        }

        /* Frostspire specific styling */
        .frostspire-active {
            background: linear-gradient(135deg, #6ab7ff, #1a7fc9) !important;
            border-color: #6ab7ff !important;
        }

        .kingdom-active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)) !important;
            border-color: var(--primary) !important;
        }

        .stonewake-active {
            background: linear-gradient(135deg, var(--stonewake-teal), #084e4e) !important;
            border-color: var(--stonewake-teal) !important;
        }

        /* Tooltip */
        .tooltip {
            display: none;
            position: fixed;
            background-color: #1d1d1d;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            z-index: 1001;
            max-width: 300px;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .tooltip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }

        .tooltip-title {
            font-size: 1rem;
            color: var(--primary);
            margin: 0;
        }

        .tooltip-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .variant-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }

        .variant-item {
            padding: 8px;
            margin-bottom: 5px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .variant-name {
            font-weight: bold;
        }

        .variant-chance {
            color: var(--primary);
            font-weight: bold;
            background-color: var(--background);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .step-panel {
            opacity: 0;
            pointer-events: none;
            transition: opacity .3s ease;
        }

        .step-panel.active {
            opacity: 1;
            pointer-events: auto;
        }

        .step-anim-in {
            animation: fadeIn .3s ease forwards;
        }

        .step-anim-out {
            animation: fadeOut .3s ease forwards;
        }

        /* Misc */
        .weapon-dagger {
            border-color: #8c8c8c;
            background: linear-gradient(135deg, rgba(140, 140, 140, 0.1), rgba(140, 140, 140, 0.05));
        }

        .weapon-straight-sword {
            border-color: #4CAF50;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
        }

        .weapon-gauntlet {
            border-color: #2196F3;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
        }

        .weapon-katana {
            border-color: #9c27b0;
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05));
        }

        .weapon-great-sword {
            border-color: #f0b209;
            background: linear-gradient(135deg, rgba(240, 178, 9, 0.1), rgba(240, 178, 9, 0.05));
        }

        .weapon-great-axe {
            border-color: #d13429;
            background: linear-gradient(135deg, rgba(209, 52, 41, 0.1), rgba(209, 52, 41, 0.05));
        }

        .weapon-colossal-sword {
            border-color: #ffeb3b;
            background: linear-gradient(135deg, rgba(255, 235, 59, 0.1), rgba(255, 235, 59, 0.05));
        }

        .armor-light {
            border-color: #8c8c8c;
            background: linear-gradient(135deg, rgba(140, 140, 140, 0.1), rgba(140, 140, 140, 0.05));
        }

        .armor-medium {
            border-color: #4CAF50;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
        }

        .armor-heavy {
            border-color: #2196F3;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
        }

        .scalable-value {
            color: var(--primary);
            font-weight: bold;
            text-shadow: 0 0 5px var(--primary-glow);
        }

        .scalable-symbol {
            font-weight: bold;
            color: var(--primary);
        }

        .ore-inventory-max .ore-item:not(.in-forge) {
            opacity: 0.4;
            filter: grayscale(0.7);
            pointer-events: none;
            cursor: not-allowed;
        }

        .ore-item.in-forge {
            border: 3px solid var(--primary) !important;
            box-shadow: 0 0 15px var(--primary-glow) !important;
            transform: scale(1.05);
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }

            to {
                opacity: 0;
                transform: translateY(10px);
            }
        }


        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }

            20% {
                transform: scale(25, 25);
                opacity: 0.3;
            }

            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }

        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {

            .slots-container {
                margin-left: 0;
                margin-right: 0;
            }

            .forge-result-tags {
                justify-content: center;
            }

            .forge-tag {
                font-size: 0.75rem;
                padding: 5px 12px;
            }

            .forge-result-header {
                flex-direction: column;
                text-align: center;
                gap: 5px;
            }

            .forge-stat-value {
                font-size: 1.2rem;
            }

            h1 {
                font-size: 1.4rem;
            }

            .stat-value {
                font-size: 1.6rem;
            }


        }

        @media (max-width: 480px) {
            body.modal-open {
                position: fixed;
                overflow: hidden;
                width: 100%;
                height: 100%;
            }

            .traits-grid {
                grid-template-columns: 1fr;
            }

            .slots-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .probability-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }

        /* Rarity Colors */
        .common {
            border-color: var(--common);
        }

        .uncommon {
            border-color: var(--uncommon);
        }

        .rare {
            border-color: var(--rare);
        }

        .epic {
            border-color: var(--epic);
        }

        .legendary {
            border-color: var(--legendary);
            border-image: var(--legendary) 1;
        }

        .mythical {
            border-color: var(--mythical);
            border-image: var(--mythical) 1;
        }

        .relic {
            border-color: var(--relic);
            border-image: var(--relic) 1;
        }

        .divine {
            border-color: var(--divine);
            border-image: var(--divine) 1;
        }

        .exotic {
            border-color: var(--exotic);
            border-image: var(--exotic) 1;
        }

        .divine .ore-name {
            color: var(--divine);
        }

        .exotic .ore-name {
            color: var(--exotic);
        }

        .common .ore-name {
            color: var(--common);
        }

        .uncommon .ore-name {
            color: var(--uncommon);
        }

        .rare .ore-name {
            color: var(--rare);
        }

        .epic .ore-name {
            color: var(--epic);
        }

        .legendary .ore-name {
            color: var(--legendary);
        }

        .mythical .ore-name {
            color: var(--mythical);
        }

        .relic .ore-name {
            color: var(--relic);
        }

        #logo-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('#');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 300px;
            z-index: -1;
        }

        /* Inventory Modal Styles */
        .inventory-modal .modal-content {
            max-width: 700px;
            width: 95%;
            padding: 20px;
        }

        .inventory-stats {
            margin-top: 15px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
        }

        .inventory-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 15px;
            margin-top: 15px;
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
        }

        .inventory-card {
            background: linear-gradient(135deg,
                    rgba(30, 30, 30, 0.9) 0%,
                    rgba(20, 20, 20, 0.95) 100%);
            border-radius: var(--border-radius);
            padding: 15px;
            border: 2px solid var(--border);
            position: relative;
            overflow: hidden;
            min-height: 200px;
            transition: all 0.3s ease;
            box-shadow: 0 0px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .inventory-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: linear-gradient(45deg, var(--ore-color-light) 25%, transparent 25%, transparent 50%, var(--ore-color-light) 50%, var(--ore-color-light) 75%, transparent 75%, transparent);
            background-size: 6px 6px;
            z-index: 1;
            pointer-events: none;
        }

        .inventory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0px 12px rgba(0, 0, 0, 0.5),
                0 0 20px var(--primary-glow);
            border-color: var(--primary);
        }

        .inventory-card-header {
            position: relative;
            z-index: 1;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
        }

        .inventory-card-ore {
            color: var(--primary);
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 5px;
            align-items: center;
            gap: 8px;
        }

        .inventory-card-item {
            color: var(--text);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .inventory-card-stats {
            position: relative;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 8px 12px 0px 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .inventory-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
            position: relative;
            padding: 4px 0;
        }

        .inventory-stat-row:not(:last-child)::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.1) 50%,
                    transparent 100%);
        }

        .inventory-stat-label {
            color: var(--text-secondary);
            flex: 1;
            font-weight: 600;
        }

        .inventory-stat-value {
            color: var(--text);
            font-weight: bold;
            text-align: right;
            min-width: 60px;
        }

        .inventory-card-traits {
            position: relative;
            z-index: 1;
            display: flex;
            flex-wrap: wrap;
            flex-direction: row-reverse;
            gap: 6px;
            margin-top: 10px;
        }

        .trait-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .trait-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg,
                    rgba(255, 255, 255, 0.1) 0%,
                    rgba(255, 255, 255, 0.05) 50%,
                    rgba(255, 255, 255, 0) 100%);
            z-index: 1;
        }

        .trait-icon:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .trait-icon i {
            color: white;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
        }

        .trait-tooltip {
            position: absolute;
            bottom: 120%;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            font-size: 0.8rem;
            min-width: 180px;
            max-width: 220px;
            display: none;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .trait-icon:nth-child(2) .trait-tooltip {
            left: 50%;
            right: auto;
            transform: translateX(-80%);
        }

        .trait-icon:nth-child(3) .trait-tooltip {
            right: 50%;
            left: auto;
            transform: translateX(35%);
        }

        .trait-icon:nth-child(4) .trait-tooltip {
            left: 50%;
            right: auto;
            transform: translateX(-50%);
        }

        .trait-icon:hover .trait-tooltip {
            display: block;
        }

        .trait-tooltip strong {
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }

        .trait-tooltip p {
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.3;
        }

        .inventory-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .inventory-empty i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .forge-preview-container {
            margin: 15px 0;
            border-radius: var(--border-radius);
            background: rgba(0, 0, 0, 0.2);
            border: 2px dashed var(--border);
            align-items: center;
            transition: all var(--animation-speed);
        }

        .forge-preview-container.has-preview {
            background: transparent;
            border: none;
        }

        .forge-preview-placeholder {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px 20px;
        }

        .forge-preview-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .forge-preview-placeholder p {
            font-size: 0.95rem;
        }

        .prediction-note {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
            font-style: italic;
            margin-top: 10px;
        }

        .preview-tooltip-trigger {
            position: relative;
            transition: all 0.2s ease;
        }

        .preview-tooltip-trigger:hover {
            transition: all 0.2s ease;
        }

        .preview-variant-tooltip {
            pointer-events: auto !important;
        }

        .quick-craft-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0 15px 0;
            position: relative;
            padding: 0 20px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            position: relative;
            transition: all 0.3s ease;
        }

        .progress-step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--text-secondary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .progress-step-label {
            margin-top: 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .progress-step.active .progress-step-circle {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-color: rgba(255, 255, 255, 0.3);
            color: white;
            box-shadow: 0 0 15px var(--primary-glow);
            transform: scale(1.1);
        }

        .progress-step.completed .progress-step-circle {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            border-color: var(--primary);
            color: white;
        }

        .progress-step.active .progress-step-label {
            color: var(--primary);
            text-shadow: 0 0 8px var(--primary-glow);
        }

        .progress-step.completed .progress-step-label {
            color: var(--text-secondary);
        }

        .progress-line {
            position: absolute;
            top: 18px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: linear-gradient(90deg,
                    var(--primary) 0%,
                    var(--primary) var(--progress-percent, 0%),
                    var(--border) var(--progress-percent, 0%),
                    var(--border) 100%);
            border-radius: 3px;
            z-index: 1;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .variant-option {
            transition: all 0.2s ease !important;
        }

        .variant-option:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
        }

        .variant-selected {
            font-weight: bold !important;
            position: relative !important;
        }

        .preview-variant-tooltip {
            animation: tooltipFadeIn 0.2s ease !important;
        }
    </style>
</head>

<body>
    <div id="logo-background"></div>
    <div class="container">
        <header>
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                <h1><i class="fas fa-hammer"></i> The Forge Crafting Calculator</h1>
            </div>
            <div class="header-controls">
                <div class="mode-toggle">
                    <button class="toggle-btn active" id="weapon-toggle">
                        &#9876; Weapons
                    </button>
                    <button class="toggle-btn" id="armor-toggle">
                        <i class="fas fa-shield-alt" style="font-size: 0.8rem;"></i> Armor
                    </button>
                </div>
            </div>
        </header>

        <div class="modal-overlay" id="quick-craft-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-bolt"></i> Quick Craft</h3>
                    <button class="modal-close" id="modal-close">&times;</button>
                </div>

                <div class="quick-craft-progress">
                    <div class="progress-line" id="progress-line"></div>
                    <div class="progress-step active" id="step-progress-0">
                        <div class="progress-step-circle">1</div>
                        <div class="progress-step-label">Type</div>
                    </div>
                    <div class="progress-step" id="step-progress-1">
                        <div class="progress-step-circle">2</div>
                        <div class="progress-step-label">Item</div>
                    </div>
                    <div class="progress-step" id="step-progress-2">
                        <div class="progress-step-circle">3</div>
                        <div class="progress-step-label">Traits</div>
                    </div>
                    <div class="progress-step" id="step-progress-3">
                        <div class="progress-step-circle">4</div>
                        <div class="progress-step-label">Summary</div>
                    </div>
                </div>

                <div class="modal-step active step-panel" id="step-type">
                    <div class="modal-options">
                        <div class="modal-option" data-type="weapon" style="display: flex; flex-direction: column;">
                            <span style="font-size: 36px; margin-top: -15px; margin-bottom: -5px;">&#9876;</span>
                            <div>Weapons</div>
                        </div>
                        <div class="modal-option" data-type="armor">
                            <i class="fas fa-shield-alt fa-2x"></i>
                            <div>Armor</div>
                        </div>
                    </div>
                </div>

                <div class="modal-step step-panel" id="step-item">
                    <div class="modal-options" id="item-options">
                    </div>
                </div>

                <div class="modal-step step-panel" id="step-traits">
                    <div id="trait-options">
                    </div>
                </div>

                <div class="modal-step step-panel" id="step-summary">
                    <div id="summary-content" style="background-color: rgba(0,0,0,0.2); border-radius: 8px;">
                    </div>
                </div>

                <div class="modal-nav">
                    <button class="control-btn reset-btn" id="prev-btn">Previous</button>
                    <button class="control-btn forge-btn" id="next-btn">Next</button>
                    <button class="control-btn forge-btn" id="craft-btn" style="display: none;">Craft Item</button>
                </div>
            </div>
        </div>

        <section class="inventory-section">
            <div class="section-title">
                <span><i class="fas fa-gem"></i> Ore List / Select Ores</span>
                <button class="quick-craft-btn" id="quick-craft-btn">
                    <i class="fas fa-bolt"></i> Quick Craft
                </button>
            </div>

            <div class="filter-search-container"
                style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                <div class="filters-dropdown">
                    <button class="filter-btn dropdown-toggle" id="filters-toggle">
                        <i class="fas fa-filter"></i> Filters
                        <i class="fas fa-chevron-down" style="font-size: 0.8rem; margin-left: 5px;"></i>
                    </button>
                    <div class="dropdown-menu" id="filters-dropdown">
                        <div class="filter-option active" data-filter="all">All Ores</div>
                        <div class="filter-option" data-filter="stonewake">Stonewake's Cross</div>
                        <div class="filter-option" data-filter="kingdom">Forgotten Kingdom</div>
                        <div class="filter-option" data-filter="frostspire">Frostspire Expanse</div>
                        <div class="filter-option" data-filter="peak">The Peak</div>
                        <div class="filter-option" data-filter="goblin">Goblin Cave</div>
                        <div class="filter-option" data-filter="enemy">Enemy Drops</div>
                        <div class="dropdown-divider"></div>
                        <div class="filter-option" data-filter="has-trait">With Traits</div>
                        <div class="filter-option" data-filter="has-weapon-trait">With Weapon Traits</div>
                        <div class="filter-option" data-filter="has-armor-trait">With Armor Traits</div>
                    </div>
                </div>
                <div class="search-container" style="position: relative; flex: 1;">
                    <i class="fas fa-search"
                        style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 0.9rem; z-index: 2;"></i>
                    <input type="text" id="ore-search" placeholder="Search ores by name, area, rarity..."
                        style="width: 100%; padding: 10px 10px 10px 35px;">
                </div>
            </div>

            <div class="ores-grid" id="ore-inventory">
            </div>
        </section>

        <section class="mix-section">
            <div class="section-title">
                <span><i class="fas fa-fire"></i> Forge</span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="filters-dropdown" style="position: relative;">
                        <button class="filter-btn dropdown-toggle" id="area-toggle-btn">
                            <i class="fas fa-map-marker-alt"></i> <span style="font-weight: 600;"
                                id="area-label">Frostspire Expanse</span>
                            <i class="fas fa-chevron-down" style="font-size: 0.8rem; margin-left: 5px;"></i>
                        </button>
                        <div class="dropdown-menu" id="area-dropdown" style="min-width: 180px;">
                            <div class="area-option" data-area="frostspire">
                                <i class="fas fa-snowflake"></i> Frostspire Expanse
                            </div>
                            <div class="area-option" data-area="kingdom">
                                <i class="fas fa-crown"></i> Forgotten Kingdom
                            </div>
                            <div class="area-option" data-area="stonewake">
                                <i class="fas fa-mountain"></i> Stonewake's Cross
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="slots-container" id="ore-slots">
                <div class="slot" id="slot-1">
                    <div class="slot-placeholder">Click an ore to add</div>
                </div>
                <div class="slot" id="slot-2">
                    <div class="slot-placeholder">Empty slot</div>
                </div>
                <div class="slot" id="slot-3">
                    <div class="slot-placeholder">Empty slot</div>
                </div>
                <div class="slot" id="slot-4">
                    <div class="slot-placeholder">Empty slot</div>
                </div>
            </div>

            <div class="forge-preview-container" id="item-preview-container">
                <div class="forge-preview-placeholder" id="forge-preview-placeholder">
                    <i class="fas fa-info-circle"></i>
                    <p>Minimum 3 ores are required to forge an item</p>
                </div>

                <div class="inventory-card forge-preview-card" id="forge-preview-card" style="display: none;">
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: center;" class="controls">
                <button class="control-btn forge-btn" id="forge-btn">
                    <i class="fas fa-fire"></i> Forge Item
                </button>
                <button class="control-btn reset-btn" id="reset-btn">
                    <i class="fas fa-redo"></i> Reset Forge
                </button>

            </div>
            <div class="traits-container">
                <div class="section-title">
                    <span><i class="fas fa-magic"></i> Ore Traits</span>
                </div>
                <div class="traits-grid" id="active-traits">
                    <div class="trait-placeholder">Add ores with traits to see effects (10% at least)...</div>
                </div>
            </div>
        </section>

        <section class="probability-section">
            <div class="section-title">
                <span><i class="fas fa-chart-pie"></i> Forge Chances</span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="quick-craft-btn" id="inventory-btn">
                        <i class="fas fa-bag-shopping"></i> Inventory
                    </button>
                </div>

            </div>
            <div class="probability-grid" id="probability-list"></div>
            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 10px; text-align: center;">(Click
                on an item type for specific item forge odds)</div>
    </div>

    <div class="tooltip" id="variant-tooltip">
        <div class="tooltip-header">
            <h3 class="tooltip-title" id="tooltip-item-name">Item Variants</h3>
            <button class="modal-close" id="tooltip-close">&times;</button>
        </div>
        <div class="tooltip-content" id="tooltip-content">
        </div>
    </div>
    </section>
    <div class="modal-overlay" id="forge-result-modal">
        <div class="modal-content" id="forge-result-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-fire"></i> Forged Item</h3>
                <button class="modal-close" id="forge-result-close">&times;</button>
            </div>
            <div id="forge-result-body">
            </div>
            <div class="modal-nav" style="justify-content: center; margin-top: 15px;">
                <button class="control-btn forge-btn" id="forge-again-btn">Forge Again</button>
                <button class="control-btn reset-btn" id="close-result-btn">Close</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay inventory-modal" id="inventory-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bag-shopping"></i> Forge History (Last 20 Items)</h3>
                <button class="modal-close" id="inventory-close">&times;</button>
            </div>

            <div class="inventory-stats">
                <span id="total-forged">Total Items Forged: 0</span> 
                <span id="total-value">Total Value: $0</span>
            </div>

            <div class="inventory-cards-container" id="inventory-cards">
                <div class="inventory-empty">
                    <i class="fas fa-box-open"></i>
                    <p>No items forged yet. Start forging to see your history!</p>
                </div>
            </div>

            <div class="modal-nav" style="justify-content: center; margin-top: 15px;">
                <button class="control-btn reset-btn" id="close-inventory-btn">Close</button>
                <button class="control-btn reset-btn" id="clear-inventory-btn"
                    style="background-color: var(--error);"><i class="fas fa-trash"></i> Clear All</button>
            </div>
        </div>
    </div>
    </div>

    <script>
        const oreImages = {
            "Stone": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/stone-the-forge-calculator.png",
            "Sand Stone": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/sand-stone-the-forge-calculator.png",
            "Copper": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/copper-the-forge-calculator.png",
            "Iron": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/iron-the-forge-calculator.png",
            "Tin": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/tin-the-forge-calculator.png",
            "Silver": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/silver-the-forge-calculator.png",
            "Gold": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/gold-the-forge-calculator.png",
            "Mushroomite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/mushroomite-the-forge-calculator.png",
            "Platinum": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/platinum-the-forge-calculator.png",
            "Bananite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/bananite-the-forge-calculator.png",
            "Cardboardite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/carboardite-the-forge-calculator.png",
            "Aite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/aite-the-forge-calculator.png",
            "Poopite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/poopite-the-forge-calculator.png",
            "Cobalt": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/cobalt-the-forge-calculator.png",
            "Titanium": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/titanium-the-forge-calculator.png",
            "Volcanic Rock": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/volcanic-rock-the-forge-calculator.png",
            "Lapis Lazuli": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/lapis-lazuli-the-forge-calculator.png",
            "Quartz": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/quartz-the-forge-calculator.png",
            "Amethyst": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/amethyst-the-forge-calculator.png",
            "Topaz": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/topaz-the-forge-calculator.png",
            "Diamond": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/diamond-the-forge-calculator.png",
            "Sapphire": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/sapphire-the-forge-calculator.png",
            "Cuprite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/cuprite-the-forge-calculator.png",
            "Obsidian": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/obsidian-the-forge-calculator.png",
            "Emerald": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/emerald-the-forge-calculator.png",
            "Ruby": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/ruby-the-forge-calculator.png",
            "Rivalite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/rivalite-the-forge-calculator.png",
            "Uranium": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/uranium-the-forge-calculator.png",
            "Mythril": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/mythril-the-forge-calculator.png",
            "Eye Ore": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/eye-ore-the-forge-calculator.png",
            "Fireite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/fireite-the-forge-calculator.png",
            "Magmaite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/magmaite-the-forge-calculator.png",
            "Lightite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/lightite-the-forge-calculator.png",
            "Demonite": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/demonite-the-forge-calculator.png",
            "Darkryte": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/darkryte-the-forge-calculator.png",
            "Magenta Crystal": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/magenta-crystal-the-forge-calculator.png",
            "Crimson Crystal": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/crimson-crystal-the-forge-calculator.png",
            "Green Crystal": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/green-crystal-the-forge-calculator.png",
            "Orange Crystal": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/orange-crystal-the-forge-calculator.png",
            "Blue Crystal": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/blue-crystal-the-forge-calculator.png",
            "Rainbow Crystal": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/rainbow-crystal-the-forge-calculator.png",
            "Arcane Crystal": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/arcane-crystal-the-forge-calculator.png",
            "Fichillium": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/fichillium-the-forge-calculator.png",
            // Frostspire
            "Tungsten": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/tungsten-the-forge-calculator.png",
            "Sulfur": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/sulfur-the-forge-calculator.png",
            "Pumice": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/pumice-the-forge-calculator.png",
            "Graphite": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/graphite-the-forge-calculator.png",
            "Aetherit": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/aetherit-the-forge-calculator.png",
            "Scheelite": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/scheelite-the-forge-calculator.png",
            "Larimar": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/larimar-the-forge-calculator.png",
            "Neurotite": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/neurotite-the-forge-calculator.png",
            "Frost Fossil": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/frost-fossil-the-forge-calculator.png",
            "Tide Carve": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/tide-carve-the-forge-calculator.png",
            "Velchire": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/velchire-the-forge-calculator.png",
            "Sanctis": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/sanctis-the-forge-calculator.png",
            "Snowite": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/snowite-the-forge-calculator.png",
            "Iceite": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/iceite-the-forge-calculator.png",

            // Peak
            "Mistvein": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/mistvein-ore-the-forge.png",
            "Lgarite": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/lgarite-ore-the-forge.png",
            "Voidfractal": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/voidfractal-ore-the-forge.png",
            "Moltenfrost": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/moltenfrost-ore-the-forge.png",
            "Crimsonite": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/crimsonite-ore-the-forge.png",
            "Malachite": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/malachite-ore-the-forge.png",
            "Aquajade": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/aquajade-ore-the-forge.png",
            "Cryptex": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/cryptex-ore-the-forge.png",
            "Galestor": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/galestor-ore-the-forge.png",
            "Voidstar": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/voidstar-ore-the-forge.png",
            "Etherealite": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/etherealite-ore-the-forge.png",
            "Suryafal": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/suryafal-ore-the-forge.png",
            "Heavenite": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/heavenite-ore-the-forge.jpg",
            "Gargantuan": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/gargantuan-ore-the-forge.png",
            "Mosasaursit": "https://bloxinformer-cdn.b-cdn.net/wp-content/uploads/2025/10/mosasaursit-ore-the-forge.jpg"
        };

        const itemImages = {
            // Daggers
            "Dagger": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dagger-the-forge-calculator.png",
            "Falchion Knife": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/falchion-knife-the-forge-calculator.png",
            "Gladius Dagger": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/gladius-dagger-the-forge-calculator.png",
            "Hook": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/hook-the-forge-calculator.png",

            // Straight Swords
            "Falchion": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/falchion-the-forge-calculator.png",
            "Gladius": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/gladius-the-forge-calculator.png",
            "Cutlass": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/cutlass-the-forge-calculator.png",
            "Rapier": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/rapier-the-forge-calculator.png",
            "Chaos": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/chaos-the-forge-calculator.png",
            "Hell Slayer": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/hell-slayer-the-forge-calculator.png",

            // Gauntlets
            "Ironhand": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/ironhand-the-forge-calculator.png",
            "Boxing Gloves": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/boxing-gloves-the-forge-calculator.png",
            "Relevator": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/relevator-the-forge-calculator.png",
            "Savage Claws": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/savage-claws-the-forge-calculator.png",

            // Katanas
            "Uchigatana": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/uchigatana-the-forge-calculator.png",
            "Tachi": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/tachi-the-forge-calculator.png",

            // Great Swords
            "Crusader Sword": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/crusader-sword-the-forge-calculator.png",
            "Long Sword": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/long-sword-the-forge-calculator.png",

            //Maces
            "Mace": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/mace-the-forge-calculator.png",
            "Winged Mace": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/winged-mace-the-forge-calculator.png",
            "Spiked Mace": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/spiked-mace-the-forge-calculator.png",
            "Hammerhead Mace": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/hammerhead-mace-the-forge-calculator.png",
            "Grave Maker": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/grave-maker-the-forge-calculator.png",

            // Axes
            "Axe": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/axe-the-forge-calculator.png",
            "Battleaxe": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/battleaxe-the-forge-calculator.png",
            "Curved Handle Axe": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/spade-armed-axe-the-forge-calculator.png",
            "Spade Armed Axe": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/curved-handle-axe-the-forge-calculator.png",

            // Spears
            "Spear": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/spear-the-forge-calculator.png",
            "Trident": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/trident-the-forge-calculator.png",
            "Angelic Spear": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/angelic-spear-the-forge-calculator.png",
            "Demonic Spear": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/demonic-spear-the-forge-calculator.png",

            // Great Axes
            "Scythe": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/scythe-the-forge-calculator.png",
            "Double Battle Axe": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/double-battle-axe-the-forge-calculator.png",
            "Greater Battle Axe": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/greater-battle-axe-the-forge-calculator.png",
            "Wyvern Axe": "https://cms.bloxinformer.com/wp-content/uploads/2025/12/wyvern-axe-the-forge-calculator.png",

            // Colossal Swords
            "Great Sword": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/great-sword-the-forge-calculator.png",
            "Dragon Slayer": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dragon-slayer-the-forge-calculator.png",
            "Hammer": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/hammer-the-forge-calculator.png",
            "Skull Crusher": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/skull-crusher-the-forge-calculator.png",
            "Comically Large Spoon": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/comically-large-spoon-the-forge-calculator.png",

            // Light Armor
            "Light Helmet": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/light-helmet-the-forge-calculator.png",
            "Light Leggings": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/light-leggings-the-forge-calculator.png",
            "Light Chestplate": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/light-chestplate-the-forge-calculator.png",

            // Medium Armor
            "Medium Helmet": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/medium-helmet-the-forge-calculator.png",
            "Samurai Helmet": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/samurai-helmet-the-forge-calculator.png",
            "Viking Helmet": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/samurai-helmet-the-forge-calculator.png",
            "Medium Leggings": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/medium-leggings-the-forge-calculator.png",
            "Samurai Leggings": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/samurai-leggings-the-forge-calculator.png",
            "Viking Leggings": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/samurai-leggings-the-forge-calculator.png",
            "Medium Chestplate": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/medium-chestplate-the-forge-calculator.png",
            "Samurai Chestplate": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/samurai-chestplate-the-forge-calculator.png",
            "Viking Chestplate": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/samurai-chestplate-the-forge-calculator.png",

            // Heavy Armor
            "Knight Helmet": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/knight-helmet-the-forge-calculator.png",
            "Dark Knight Helmet": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dark-knight-helmet-the-forge-calculator.png",
            "Wolf Helmet": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dark-knight-chestplate-the-forge-calculator.png",
            "Knight Leggings": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/knight-leggings-the-forge-calculator.png",
            "Dark Knight Leggings": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dark-knight-leggings-the-forge-calculator.png",
            "Wolf Leggings": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dark-knight-chestplate-the-forge-calculator.png",
            "Knight Chestplate": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/knight-chestplate-the-forge-calculator.png",
            "Dark Knight Chestplate": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dark-knight-chestplate-the-forge-calculator.png",
            "Wolf Chestplate": "https://cms.bloxinformer.com/wp-content/uploads/2025/04/dark-knight-chestplate-the-forge-calculator.png"
        };

        const baseItemStats = {
            weapon: {
                "Dagger": { damage: 8.6, atkSpeed: 0.35, range: 6, price: 68, type: "Dagger" },
                "Falchion Knife": { damage: 8.6, atkSpeed: 0.35, range: 6, price: 68, type: "Dagger" },
                "Gladius Dagger": { damage: 8.6, atkSpeed: 0.35, range: 6, price: 68, type: "Dagger" },
                "Hook": { damage: 9.46, atkSpeed: 0.39, range: 6, price: 68, type: "Dagger" },

                "Falchion": { damage: 15, atkSpeed: 0.59, range: 8, price: 120, type: "Straight Sword" },
                "Gladius": { damage: 15.75, atkSpeed: 0.62, range: 8, price: 120, type: "Straight Sword" },
                "Cutlass": { damage: 18.75, atkSpeed: 0.66, range: 8, price: 120, type: "Straight Sword" },
                "Rapier": { damage: 15, atkSpeed: 0.49, range: 8, price: 120, type: "Straight Sword" },
                "Chaos": { damage: 18.75, atkSpeed: 0.59, range: 6, price: 120, type: "Straight Sword" },
                "Hell Slayer": { damage: 20.25, atkSpeed: 0.59, range: 8, price: 120, type: "Straight Sword" },

                "Ironhand": { damage: 15.2, atkSpeed: 0.51, range: 6, price: 205, type: "Gauntlet" },
                "Boxing Gloves": { damage: 16, atkSpeed: 0.59, range: 6, price: 205, type: "Gauntlet" },
                "Relevator": { damage: 19.2, atkSpeed: 0.69, range: 6, price: 205, type: "Gauntlet" },
                "Savage Claws": { damage: 16, atkSpeed: 0.47, range: 6, price: 205, type: "Gauntlet" },

                "Mace": { damage: 12, atkSpeed: 0.46, range: 8, price: 205, type: "Mace" },
                "Spiked Mace": { damage: 12.6, atkSpeed: 0.46, range: 8, price: 205, type: "Mace" },
                "Winged Mace": { damage: 13.2, atkSpeed: 0.46, range: 8, price: 205, type: "Mace" },
                "Hammerhead Mace": { damage: 13.8, atkSpeed: 0.46, range: 8, price: 205, type: "Mace" },
                "Grave Maker": { damage: 15.6, atkSpeed: 0.46, range: 8, price: 205, type: "Mace" },

                "Axe": { damage: 14, atkSpeed: 0.48, range: 8, price: 205, type: "Axe" },
                "Battleaxe": { damage: 14.7, atkSpeed: 0.48, range: 8, price: 205, type: "Axe" },
                "Curved Handle Axe": { damage: 15.4, atkSpeed: 0.48, range: 8, price: 205, type: "Axe" },
                "Spade Armed Axe": { damage: 16.1, atkSpeed: 0.48, range: 8, price: 205, type: "Axe" },

                "Spear": { damage: 15, atkSpeed: 0.45, range: 11, price: 120, type: "Spear" },
                "Trident": { damage: 15, atkSpeed: 0.45, range: 11, price: 120, type: "Spear" },
                "Demonic Spear": { damage: 18, atkSpeed: 0.56, range: 11, price: 120, type: "Spear" },
                "Angelic Spear": { damage: 19.5, atkSpeed: 0.41, range: 11, price: 120, type: "Spear" },

                "Uchigatana": { damage: 17, atkSpeed: 0.6, range: 9, price: 324, type: "Katana" },
                "Tachi": { damage: 17.85, atkSpeed: 0.63, range: 9, price: 324, type: "Katana" },

                "Crusader Sword": { damage: 24, atkSpeed: 1.0, range: 9, price: 485, type: "Great Sword" },
                "Long Sword": { damage: 24, atkSpeed: 1.11, range: 9, price: 485, type: "Great Sword" },

                "Double Battle Axe": { damage: 31.5, atkSpeed: 1.05, range: 9, price: 850, type: "Great Axe" },
                "Scythe": { damage: 28.5, atkSpeed: 0.95, range: 9, price: 850, type: "Great Axe" },
                "Greater Battle Axe": { damage: 34.5, atkSpeed: 1, range: 9, price: 850, type: "Great Axe" },
                "Wyvern Axe": { damage: 37.5, atkSpeed: 0.91, range: 9, price: 850, type: "Great Axe" },

                "Great Sword": { damage: 40, atkSpeed: 1.12, range: 10, price: 1355, type: "Colossal Sword" },
                "Dragon Slayer": { damage: 44, atkSpeed: 1.12, range: 10, price: 1355, type: "Colossal Sword" },
                "Hammer": { damage: 44, atkSpeed: 1.24, range: 10, price: 1355, type: "Colossal Sword" },
                "Skull Crusher": { damage: 48, atkSpeed: 1.4, range: 10, price: 1355, type: "Colossal Sword" },
                "Comically Large Spoon": { damage: 36, atkSpeed: 1.12, range: 10, price: 1355, type: "Colossal Sword" }
            },
            armor: {
                "Light Helmet": { health: 3.75, price: 65, def: 8, type: "Light Helmet" },
                "Light Leggings": { health: 4.375, price: 112.5, def: 9, type: "Light Leggings" },
                "Light Chestplate": { health: 5, price: 225, def: 10, type: "Light Chestplate" },

                "Medium Helmet": { health: 6.25, price: 335, def: 12, type: "Medium Helmet" },
                "Samurai Helmet": { health: 8, price: 335, def: 16, type: "Medium Helmet" },
                "Viking Helmet": { health: 10.5, price: 402, def: 20, type: "Medium Helmet" },
                "Medium Leggings": { health: 7.5, price: 485, def: 15, type: "Medium Leggings" },
                "Samurai Leggings": { health: 9, price: 485, def: 20, type: "Medium Leggings" },
                "Viking Leggings": { health: 11, price: 630, def: 25, type: "Medium Leggings" },
                "Medium Chestplate": { health: 8.75, price: 850, def: 18, type: "Medium Chestplate" },
                "Samurai Chestplate": { health: 12.75, price: 850, def: 24, type: "Medium Chestplate" },
                "Viking Chestplate": { health: 15, price: 1210, def: 30, type: "Medium Chestplate" },

                "Knight Helmet": { health: 12.5, price: 1020, def: 24, type: "Heavy Helmet" },
                "Dark Knight Helmet": { health: 18.75, price: 1224, def: 38, type: "Heavy Helmet" },
                "Wolf Helmet": { health: 25, price: 1330, def: 50, type: "Heavy Helmet" },
                "Knight Leggings": { health: 13.75, price: 1200, def: 28, type: "Heavy Leggings" },
                "Dark Knight Leggings": { health: 21.875, price: 1440, def: 44, type: "Heavy Leggings" },
                "Wolf Leggings": { health: 28, price: 1560, def: 56, type: "Heavy Leggings" },
                "Knight Chestplate": { health: 16.25, price: 1355, def: 32, type: "Heavy Chestplate" },
                "Dark Knight Chestplate": { health: 25, price: 1626, def: 50, type: "Heavy Chestplate" },
                "Wolf Chestplate": { health: 35, price: 1812, def: 70, type: "Heavy Chestplate" }
            }
        };

        const oreData = [
            // Stonewake's Cross
            { id: 1, name: "Stone", multiplier: 0.2, rarity: "common", area: "stonewake", color: "#7b7773", traitType: null, traits: [] },
            { id: 2, name: "Sand Stone", multiplier: 0.25, rarity: "common", area: "stonewake", color: "#c3a777", traitType: null, traits: [] },
            { id: 3, name: "Copper", multiplier: 0.3, rarity: "common", area: "stonewake", color: "#925d3e", traitType: null, traits: [] },
            { id: 4, name: "Iron", multiplier: 0.35, rarity: "common", area: "stonewake", color: "#827356", traitType: null, traits: [] },
            { id: 5, name: "Tin", multiplier: 0.425, rarity: "uncommon", area: "stonewake", color: "#69707b", traitType: null, traits: [] },
            { id: 6, name: "Silver", multiplier: 0.5, rarity: "uncommon", area: "stonewake", color: "#bad0e0", traitType: null, traits: [] },
            { id: 7, name: "Gold", multiplier: 0.65, rarity: "uncommon", area: "stonewake", color: "#c89d40", traitType: null, traits: [] },
            { id: 8, name: "Mushroomite", multiplier: 0.8, rarity: "rare", area: "stonewake", color: "#9b8768", traitType: null, traits: [] },
            { id: 9, name: "Platinum", multiplier: 0.8, rarity: "rare", area: "stonewake", color: "#d6dee6", traitType: null, traits: [] },
            { id: 10, name: "Bananite", multiplier: 0.85, rarity: "uncommon", area: "stonewake", color: "#edbe70", traitType: null, traits: [] },
            { id: 11, name: "Cardboardite", multiplier: 0.7, rarity: "common", area: "stonewake", color: "#a28161", traitType: null, traits: [] },
            { id: 12, name: "Aite", multiplier: 1.0, rarity: "epic", area: "stonewake", color: "#f0d2a7", traitType: null, traits: [] },
            {
                id: 13, name: "Poopite", multiplier: 1.2, rarity: "epic", area: "stonewake", color: "#5f4937", traitType: "all", traits: [
                    {
                        description: "Deal {damage}% Poison DMG in AoE for {duration}s, fearing enemies (15s CD). Activates when HP drops below 35%.",
                        scaling: { damage: { min: 1.5, max: 15 }, duration: { min: 0.5, max: 5 } }, type: "all"
                    }
                ]
            },
            { id: 46, name: "Fichillium", multiplier: 0, rarity: "relic", area: "stonewake", color: "#c0a15b", traitType: null, traits: [] },

            // Forgotten Kingdom
            { id: 14, name: "Cobalt", multiplier: 1.0, rarity: "uncommon", area: "kingdom", color: "#579de7", traitType: null, traits: [] },
            { id: 15, name: "Titanium", multiplier: 1.15, rarity: "uncommon", area: "kingdom", color: "#aca895", traitType: null, traits: [] },
            { id: 16, name: "Volcanic Rock", multiplier: 1.55, rarity: "rare", area: "kingdom", color: "#504b44", traitType: null, traits: [] },
            { id: 17, name: "Lapis Lazuli", multiplier: 1.3, rarity: "uncommon", area: "kingdom", color: "#5c89dc", traitType: null, traits: [] },
            { id: 18, name: "Quartz", multiplier: 1.5, rarity: "rare", area: "kingdom", color: "#b6dffd", traitType: null, traits: [] },
            { id: 19, name: "Amethyst", multiplier: 1.65, rarity: "rare", area: "kingdom", color: "#957aed", traitType: null, traits: [] },
            { id: 20, name: "Topaz", multiplier: 1.75, rarity: "rare", area: "kingdom", color: "#deb7a4", traitType: null, traits: [] },
            { id: 21, name: "Diamond", multiplier: 2.0, rarity: "rare", area: "kingdom", color: "#aef8fa", traitType: null, traits: [] },
            { id: 22, name: "Sapphire", multiplier: 2.25, rarity: "rare", area: "kingdom", color: "#7bbdfa", traitType: null, traits: [] },
            { id: 23, name: "Cuprite", multiplier: 2.43, rarity: "epic", area: "kingdom", color: "#7a3034", traitType: null, traits: [] },
            {
                id: 24, name: "Obsidian", multiplier: 2.35, rarity: "epic", area: "kingdom", color: "#4b2e87", traitType: "armor", traits: [
                    { description: "+{health}% extra health.", scaling: { health: { min: 3, max: 30 } }, type: "armor" }
                ]
            },
            { id: 25, name: "Emerald", multiplier: 2.55, rarity: "epic", area: "kingdom", color: "#5fb172", traitType: null, traits: [] },
            { id: 26, name: "Ruby", multiplier: 2.95, rarity: "epic", area: "kingdom", color: "#cc4a53", traitType: null, traits: [] },
            {
                id: 27, name: "Rivalite", multiplier: 3.33, rarity: "epic", area: "kingdom", color: "#8e4a4c", traitType: "weapon", traits: [
                    { description: "+{crit}% critical chance.", scaling: { crit: { min: 2, max: 20 } }, type: "weapon" }
                ]
            },
            {
                id: 28, name: "Uranium", multiplier: 3.0, rarity: "legendary", area: "kingdom", color: "#97c889", traitType: "armor", traits: [
                    { description: "Deal {damage}% of max health as AoE DMG while in-combat.", scaling: { damage: { min: 0.5, max: 5 } }, type: "armor" }
                ]
            },
            {
                id: 29, name: "Mythril", multiplier: 3.5, rarity: "legendary", area: "kingdom", color: "#9f61fa", traitType: "armor", traits: [
                    { description: "+{health}% extra health.", scaling: { health: { min: 1.5, max: 15 } }, type: "armor" }
                ]
            },
            {
                id: 30, name: "Eye Ore", multiplier: 4.0, rarity: "legendary", area: "kingdom", color: "#fab67f", traitType: "all", traits: [
                    {
                        description: "Increase physical damage by +{damage}% and decrease health by -{health}%.",
                        scaling: { damage: { min: 1.5, max: 15 }, health: { min: 1, max: 10 } }, type: "all"
                    }
                ]
            },
            {
                id: 31, name: "Fireite", multiplier: 4.5, rarity: "legendary", area: "kingdom", color: "#a4532e", traitType: "weapon", traits: [
                    {
                        description: "Deals {damage}% of weapon damage as fire per second for 2 seconds. 30% chance on hit.",
                        scaling: { damage: { min: 2, max: 20 } }, type: "weapon"
                    }
                ]
            },
            {
                id: 32, name: "Magmaite", multiplier: 5.0, rarity: "legendary", area: "kingdom", color: "#f77b61", traitType: "weapon", traits: [
                    {
                        description: "Cause an explosion on hit, dealing {damage}% of weapon damage as AoE damage. 35% chance on hit.",
                        scaling: { damage: { min: 5, max: 50 } }, type: "weapon"
                    }
                ]
            },
            {
                id: 33, name: "Lightite", multiplier: 4.6, rarity: "legendary", area: "kingdom", color: "#9ac9fa", traitType: "armor", traits: [
                    { description: "+{speed}% extra movement speed.", scaling: { speed: { min: 1.5, max: 15 } }, type: "armor" }
                ]
            },
            {
                id: 34, name: "Demonite", multiplier: 5.5, rarity: "mythical", area: "kingdom", color: "#7d1b1d", traitType: "armor", traits: [
                    {
                        description: "Deals {damage}% of weapon damage as fire per second for 2 seconds. 15% chance on hit and 25% chance when hit by an enemy.",
                        scaling: { damage: { min: 2, max: 20 } }, type: "armor"
                    }
                ]
            },
            {
                id: 35, name: "Darkryte", multiplier: 6.3, rarity: "mythical", area: "kingdom", color: "#f0f0f0", traitType: "armor", traits: [
                    {
                        description: "Upon taking damage, there is a {chance}% chance to turn into a shadow and dodge the attack.",
                        scaling: { chance: { min: 1.5, max: 15 } }, type: "armor"
                    }
                ]
            },

            // Goblin Cave
            { id: 36, name: "Magenta Crystal", multiplier: 3.1, rarity: "epic", area: "goblin", color: "#795ef8", traitType: null, traits: [] },
            { id: 37, name: "Crimson Crystal", multiplier: 3.3, rarity: "epic", area: "goblin", color: "#9a5065", traitType: null, traits: [] },
            { id: 38, name: "Green Crystal", multiplier: 3.2, rarity: "epic", area: "goblin", color: "#68c87b", traitType: null, traits: [] },
            { id: 39, name: "Orange Crystal", multiplier: 3.0, rarity: "epic", area: "goblin", color: "#d8792a", traitType: null, traits: [] },
            { id: 40, name: "Blue Crystal", multiplier: 3.4, rarity: "epic", area: "goblin", color: "#699cf1", traitType: null, traits: [] },
            { id: 41, name: "Rainbow Crystal", multiplier: 5.25, rarity: "legendary", area: "goblin", color: "#1b7c3a", traitType: null, traits: [] },
            { id: 42, name: "Arcane Crystal", multiplier: 7.5, rarity: "mythical", area: "goblin", color: "#c8dbf5", traitType: null, traits: [] },

            // Enemy Drops
            { id: 43, name: "Boneite", multiplier: 1.2, rarity: "rare", area: "enemy", color: "#f5f5dc", traitType: null, traits: [] },
            { id: 44, name: "Dark Boneite", multiplier: 2.25, rarity: "rare", area: "enemy", color: "#696969", traitType: null, traits: [] },
            { id: 45, name: "Slimite", multiplier: 2.25, rarity: "epic", area: "enemy", color: "#32cd32", traitType: null, traits: [] },

            // Fichillium is defined above with id 46
            // Frostspire Expanse
            { id: 47, name: "Tungsten", multiplier: 2.6, rarity: "common", area: "frostspire", color: "#a5b1c9", traitType: null, traits: [] },
            { id: 48, name: "Sulfur", multiplier: 2.75, rarity: "uncommon", area: "frostspire", color: "#e0dbb3", traitType: null, traits: [] },
            {
                id: 49, name: "Pumice", multiplier: 2.9, rarity: "rare", area: "frostspire", color: "#d6cedd", traitType: "armor", traits: [
                    { description: "+{health}% extra health.", scaling: { health: { min: 0.5, max: 5 } }, type: "armor" }
                ]
            },
            {
                id: 50, name: "Graphite", multiplier: 3.1, rarity: "rare", area: "frostspire", color: "#656b7b", traitType: "armor", traits: [
                    { description: "Reduce incoming physical damage by {damage}%. Has 20% chance per hit.", scaling: { damage: { min: 1.2, max: 12 } }, type: "armor" }
                ]
            },
            {
                id: 51, name: "Aetherit", multiplier: 3.4, rarity: "rare", area: "frostspire", color: "#e2f0ff", traitType: "armor", traits: [
                    { description: "+{speed}% extra movement speed.", scaling: { speed: { min: 0.5, max: 5 } }, type: "armor" }
                ]
            },
            { id: 52, name: "Scheelite", multiplier: 3.3, rarity: "rare", area: "frostspire", color: "#f5c4a3", traitType: null, traits: [] },
            { id: 53, name: "Larimar", multiplier: 4.1, rarity: "epic", area: "frostspire", color: "#aac3e1", traitType: null, traits: [] },
            { id: 54, name: "Neurotite", multiplier: 4.3, rarity: "epic", area: "frostspire", color: "#65809b", traitType: null, traits: [] },
            {
                id: 55, name: "Frost Fossil", multiplier: 4.5, rarity: "epic", area: "frostspire", color: "#5d7a7e", traitType: "all", traits: [
                    { description: "Increase physical damage by +{damage}% and decrease movement speed by -{speed}%.", scaling: { damage: { min: 1.75, max: 17.5 }, speed: { min: 0.5, max: 5 } }, type: "all" }
                ]
            },
            { id: 56, name: "Tide Carve", multiplier: 4.7, rarity: "epic", area: "frostspire", color: "#3d3c66", traitType: null, traits: [] },
            {
                id: 57, name: "Velchire", multiplier: 5.5, rarity: "legendary", area: "frostspire", color: "#f0fdb8", traitType: "armor", traits: [
                    { description: "+{speed}% extra movement speed.", scaling: { speed: { min: 2, max: 20 } }, type: "armor" }
                ]
            },
            {
                id: 58, name: "Sanctis", multiplier: 6.0, rarity: "legendary", area: "frostspire", color: "#b6b9c8", traitType: "armor", traits: [
                    { description: "+{stamina}% more stamina.", scaling: { stamina: { min: 1.8, max: 18 } }, type: "armor" }
                ]
            },
            {
                id: 59, name: "Snowite", multiplier: 8.0, rarity: "legendary", area: "frostspire", color: "#dcd9d4", traitType: "weapon", traits: [
                    { description: "Applies {slow}% attack speed and movement speed slow for {duration}s. 30% chance on hit.", scaling: { slow: { min: 1.5, max: 15 }, duration: { min: 0.3, max: 3 } }, type: "weapon" }
                ]
            },
            {
                id: 60, name: "Iceite", multiplier: 10.5, rarity: "mythical", area: "frostspire", color: "#6591c0", traitType: "weapon", traits: [
                    { description: "Freeze enemies for {duration}s. 25% chance on hit. Has a cooldown of 12s.", scaling: { duration: { min: 0.2, max: 2 } }, type: "weapon" }
                ]
            },


            // Peak
            { id: 61, name: "Mistvein", multiplier: 7.2, rarity: "rare", area: "peak", color: "#adb8f5", traitType: null, traits: [] },
            { id: 62, name: "Lgarite", multiplier: 7.5, rarity: "rare", area: "peak", color: "#f57d60", traitType: null, traits: [] },
            { id: 63, name: "Voidfractal", multiplier: 8.0, rarity: "rare", area: "peak", color: "#aca0ee", traitType: null, traits: [] },
            { id: 64, name: "Moltenfrost", multiplier: 8.3, rarity: "epic", area: "peak", color: "#adcae5", traitType: null, traits: [] },
            {
                id: 65, name: "Crimsonite", multiplier: 8.5, rarity: "epic", area: "peak", color: "#c26073", traitType: "weapon", traits: [
                    { description: "Increase physical damage by +{damage}%.", scaling: { damage: { min: 0.2, max: 20 } }, type: "weapon" }
                ]
            },
            {
                id: 66, name: "Malachite", multiplier: 8.8, rarity: "epic", area: "peak", color: "#a89be4", traitType: "weapon", traits: [
                    { description: "Deals {damage}% of your weapon damage per second as poison for {duration}s. 33% chance to hit.", scaling: { damage: { min: 1, max: 10 }, duration: { min: 0.3, max: 3 } }, type: "weapon" }
                ]
            },
            { id: 67, name: "Aquajade", multiplier: 9.0, rarity: "epic", area: "peak", color: "#7fdce4", traitType: null, traits: [] },
            { id: 68, name: "Cryptex", multiplier: 9.3, rarity: "epic", area: "peak", color: "#5ec9da", traitType: null, traits: [] },
            { id: 69, name: "Galestor", multiplier: 9.5, rarity: "epic", area: "peak", color: "#495d77", traitType: null, traits: [] },
            {
                id: 70, name: "Voidstar", multiplier: 10.0, rarity: "legendary", area: "peak", color: "#c393f7", traitType: "weapon", traits: [
                    { description: "Increases critical chance by +{crit}% and critical damage by +{critDamage}%, but lowers vitality by -{health}%.", scaling: { crit: { min: 3.3, max: 33 }, critDamage: { min: 1.5, max: 15 }, health: { min: 1.5, max: 15 } }, type: "weapon" }
                ]
            },
            {
                id: 71, name: "Etherealite", multiplier: 11.1, rarity: "mythical", area: "peak", color: "#e8b9e1", traitType: "armor", traits: [
                    { description: "Increases vitality by +{health}%.", scaling: { health: { min: 3.5, max: 35 } }, type: "armor" }
                ]
            },
            { id: 72, name: "Suryafal", multiplier: 17.5, rarity: "relic", area: "peak", color: "#f69e40", traitType: null, traits: [] },
            { id: 73, name: "Heavenite", multiplier: 25.0, rarity: "divine", area: "peak", color: "#fff4c0", traitType: null, traits: [] },
            { id: 74, name: "Gargantuan", multiplier: 33.3, rarity: "divine", area: "peak", color: "#ffde65", traitType: null, traits: [] },
            {
                id: 75, name: "Mosasaursit", multiplier: 7.0, rarity: "exotic", area: "peak", color: "#687196", traitType: "armor", traits: [
                    { description: "Increases vitality by +{health}%, but lowers movement speed by -{speed}%.", scaling: { health: { min: 6.5, max: 65 }, speed: { min: 2.5, max: 25 } }, type: "armor" }
                ]
            }
        ];

        const traitIconMapping = {
            // Stonewake's Cross
            13: { icon: 'fas fa-skull-crossbones', color: '#5f4937' }, // Poopite

            // Forgotten Kingdom
            24: { icon: 'fas fa-heart', color: '#4b2e87' }, // Obsidian
            27: { icon: 'fas fa-crosshairs', color: '#8e4a4c' }, // Rivalite
            28: { icon: 'fas fa-skull', color: '#97c889' }, // Uranium
            29: { icon: 'fas fa-heart', color: '#9f61fa' }, // Mythril
            30: { icon: 'fas fa-fan', color: '#fab67f' }, // Eye Ore
            31: { icon: 'fas fa-fire', color: '#a4532e' }, // Fireite
            32: { icon: 'fas fa-bomb', color: '#f77b61' }, // Magmaite
            33: { icon: 'fas fa-running', color: '#9ac9fa' }, // Lightite
            34: { icon: 'fas fa-fire', color: '#7d1b1d' }, // Demonite
            35: { icon: 'fas fa-ghost', color: '#f0f0f0' }, // Darkryte

            // Frostspire Expanse
            49: { icon: 'fas fa-heart', color: '#d6cedd' }, // Pumice
            50: { icon: 'fas fa-shield', color: '#656b7b' }, // Graphite
            51: { icon: 'fas fa-running', color: '#e2f0ff' }, // Aetherit
            55: { icon: 'fas fa-fan', color: '#5d7a7e' }, // Frost Fossil
            57: { icon: 'fas fa-running', color: '#f0fdb8' }, // Velchire
            58: { icon: 'fas fa-shield', color: '#b6b9c8' }, // Sanctis
            59: { icon: 'fas fa-snowflake', color: '#dcd9d4' }, // Snowite
            60: { icon: 'fas fa-snowflake', color: '#6591c0' },  // Iceite

            // Peak
            65: { icon: 'fas fa-fan', color: '#c26073' }, // Crimsonite
            66: { icon: 'fas fa-skull-crossbones', color: '#a89be4' }, // Malachite
            70: { icon: 'fas fa-crosshairs', color: '#c393f7' }, // Voidstar
            71: { icon: 'fas fa-heart', color: '#e8b9e1' }, // Etherealite
            75: { icon: 'fas fa-heart', color: '#687196' }  // Mosasaursit
        };

        // Weapon probability data
        const weaponProbabilities = {
            3: { "Dagger": 1.0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            4: { "Dagger": 0.86, "Straight Sword": 0.14, "Gauntlet": 0, "Katana": 0, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            5: { "Dagger": 0.35, "Straight Sword": 0.65, "Gauntlet": 0, "Katana": 0, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            6: { "Dagger": 0.14, "Straight Sword": 0.86, "Gauntlet": 0, "Katana": 0, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            7: { "Dagger": 0.06, "Straight Sword": 0.74, "Gauntlet": 0.2, "Katana": 0, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            8: { "Dagger": 0.02, "Straight Sword": 0.44, "Gauntlet": 0.54, "Katana": 0, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            9: { "Dagger": 0.01, "Straight Sword": 0.24, "Gauntlet": 0.65, "Katana": 0.1, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            10: { "Dagger": 0, "Straight Sword": 0.11, "Gauntlet": 0.47, "Katana": 0.42, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            11: { "Dagger": 0, "Straight Sword": 0.05, "Gauntlet": 0.32, "Katana": 0.63, "Great Sword": 0, "Great Axe": 0, "Colossal Sword": 0 },
            12: { "Dagger": 0, "Straight Sword": 0.03, "Gauntlet": 0.22, "Katana": 0.72, "Great Sword": 0.03, "Great Axe": 0, "Colossal Sword": 0 },
            13: { "Dagger": 0, "Straight Sword": 0.01, "Gauntlet": 0.15, "Katana": 0.62, "Great Sword": 0.22, "Great Axe": 0, "Colossal Sword": 0 },
            14: { "Dagger": 0, "Straight Sword": 0.01, "Gauntlet": 0.08, "Katana": 0.46, "Great Sword": 0.45, "Great Axe": 0, "Colossal Sword": 0 },
            15: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0.05, "Katana": 0.35, "Great Sword": 0.6, "Great Axe": 0, "Colossal Sword": 0 },
            16: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0.03, "Katana": 0.26, "Great Sword": 0.70, "Great Axe": 0.01, "Colossal Sword": 0 },
            17: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0.02, "Katana": 0.19, "Great Sword": 0.68, "Great Axe": 0.11, "Colossal Sword": 0 },
            18: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0.02, "Katana": 0.13, "Great Sword": 0.57, "Great Axe": 0.28, "Colossal Sword": 0 },
            19: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0.01, "Katana": 0.08, "Great Sword": 0.46, "Great Axe": 0.45, "Colossal Sword": 0 },
            20: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0.01, "Katana": 0.06, "Great Sword": 0.36, "Great Axe": 0.57, "Colossal Sword": 0 },
            21: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.04, "Great Sword": 0.29, "Great Axe": 0.65, "Colossal Sword": 0.02 },
            22: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.03, "Great Sword": 0.23, "Great Axe": 0.67, "Colossal Sword": 0.07 },
            23: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.02, "Great Sword": 0.19, "Great Axe": 0.66, "Colossal Sword": 0.13 },
            24: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.02, "Great Sword": 0.15, "Great Axe": 0.63, "Colossal Sword": 0.2 },
            25: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.01, "Great Sword": 0.12, "Great Axe": 0.6, "Colossal Sword": 0.27 },
            26: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.01, "Great Sword": 0.1, "Great Axe": 0.56, "Colossal Sword": 0.32 },
            27: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.01, "Great Sword": 0.09, "Great Axe": 0.53, "Colossal Sword": 0.37 },
            28: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.01, "Great Sword": 0.07, "Great Axe": 0.5, "Colossal Sword": 0.42 },
            29: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.01, "Great Sword": 0.07, "Great Axe": 0.47, "Colossal Sword": 0.46 },
            30: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0.01, "Great Sword": 0.06, "Great Axe": 0.45, "Colossal Sword": 0.49 },
            31: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.05, "Great Axe": 0.44, "Colossal Sword": 0.51 },
            32: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.05, "Great Axe": 0.41, "Colossal Sword": 0.54 },
            33: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.04, "Great Axe": 0.39, "Colossal Sword": 0.57 },
            34: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.04, "Great Axe": 0.38, "Colossal Sword": 0.58 },
            35: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.04, "Great Axe": 0.37, "Colossal Sword": 0.59 },
            36: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.03, "Great Axe": 0.36, "Colossal Sword": 0.61 },
            37: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.03, "Great Axe": 0.35, "Colossal Sword": 0.62 },
            38: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.03, "Great Axe": 0.34, "Colossal Sword": 0.63 },
            39: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.03, "Great Axe": 0.33, "Colossal Sword": 0.64 },
            40: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.03, "Great Axe": 0.32, "Colossal Sword": 0.65 },
            41: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.03, "Great Axe": 0.32, "Colossal Sword": 0.65 },
            42: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.03, "Great Axe": 0.31, "Colossal Sword": 0.66 },
            43: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.31, "Colossal Sword": 0.67 },
            44: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.3, "Colossal Sword": 0.68 },
            45: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.3, "Colossal Sword": 0.68 },
            46: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.29, "Colossal Sword": 0.69 },
            47: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.29, "Colossal Sword": 0.69 },
            48: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.28, "Colossal Sword": 0.7 },
            49: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.28, "Colossal Sword": 0.7 },
            50: { "Dagger": 0, "Straight Sword": 0, "Gauntlet": 0, "Katana": 0, "Great Sword": 0.02, "Great Axe": 0.28, "Colossal Sword": 0.7 }
        };

        const weaponProbabilitiesFrostspire = {
            3: { "Dagger": 1.0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            4: { "Dagger": 0.86, "Straight Sword": 0.14, "Mace": 0, "Axe": 0, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            5: { "Dagger": 0.35, "Straight Sword": 0.65, "Mace": 0, "Axe": 0, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            6: { "Dagger": 0.14, "Straight Sword": 0.86, "Mace": 0, "Axe": 0, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            7: { "Dagger": 0.06, "Straight Sword": 0.74, "Mace": 0.2, "Axe": 0, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            8: { "Dagger": 0.02, "Straight Sword": 0.44, "Mace": 0.54, "Axe": 0.12, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            9: { "Dagger": 0.01, "Straight Sword": 0.24, "Mace": 0.65, "Axe": 0.1, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            10: { "Dagger": 0, "Straight Sword": 0.11, "Mace": 0.47, "Axe": 0.42, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            11: { "Dagger": 0, "Straight Sword": 0.05, "Mace": 0.32, "Axe": 0.63, "Spear": 0, "Great Axe": 0, "Colossal Sword": 0 },
            12: { "Dagger": 0, "Straight Sword": 0.03, "Mace": 0.22, "Axe": 0.72, "Spear": 0.03, "Great Axe": 0, "Colossal Sword": 0 },
            13: { "Dagger": 0, "Straight Sword": 0.01, "Mace": 0.15, "Axe": 0.62, "Spear": 0.22, "Great Axe": 0, "Colossal Sword": 0 },
            14: { "Dagger": 0, "Straight Sword": 0.01, "Mace": 0.08, "Axe": 0.46, "Spear": 0.45, "Great Axe": 0, "Colossal Sword": 0 },
            15: { "Dagger": 0, "Straight Sword": 0, "Mace": 0.05, "Axe": 0.35, "Spear": 0.6, "Great Axe": 0, "Colossal Sword": 0 },
            16: { "Dagger": 0, "Straight Sword": 0, "Mace": 0.03, "Axe": 0.26, "Spear": 0.70, "Great Axe": 0.01, "Colossal Sword": 0 },
            17: { "Dagger": 0, "Straight Sword": 0, "Mace": 0.02, "Axe": 0.19, "Spear": 0.68, "Great Axe": 0.11, "Colossal Sword": 0 },
            18: { "Dagger": 0, "Straight Sword": 0, "Mace": 0.02, "Axe": 0.13, "Spear": 0.57, "Great Axe": 0.28, "Colossal Sword": 0 },
            19: { "Dagger": 0, "Straight Sword": 0, "Mace": 0.01, "Axe": 0.08, "Spear": 0.46, "Great Axe": 0.45, "Colossal Sword": 0 },
            20: { "Dagger": 0, "Straight Sword": 0, "Mace": 0.01, "Axe": 0.06, "Spear": 0.36, "Great Axe": 0.57, "Colossal Sword": 0 },
            21: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.04, "Spear": 0.29, "Great Axe": 0.65, "Colossal Sword": 0.02 },
            22: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.03, "Spear": 0.23, "Great Axe": 0.67, "Colossal Sword": 0.07 },
            23: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.02, "Spear": 0.19, "Great Axe": 0.66, "Colossal Sword": 0.13 },
            24: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.02, "Spear": 0.15, "Great Axe": 0.63, "Colossal Sword": 0.2 },
            25: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.01, "Spear": 0.12, "Great Axe": 0.6, "Colossal Sword": 0.27 },
            26: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.01, "Spear": 0.1, "Great Axe": 0.56, "Colossal Sword": 0.32 },
            27: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.01, "Spear": 0.09, "Great Axe": 0.53, "Colossal Sword": 0.37 },
            28: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.01, "Spear": 0.07, "Great Axe": 0.5, "Colossal Sword": 0.42 },
            29: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.01, "Spear": 0.07, "Great Axe": 0.47, "Colossal Sword": 0.46 },
            30: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0.01, "Spear": 0.06, "Great Axe": 0.45, "Colossal Sword": 0.49 },
            31: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.05, "Great Axe": 0.44, "Colossal Sword": 0.51 },
            32: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.05, "Great Axe": 0.41, "Colossal Sword": 0.54 },
            33: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.04, "Great Axe": 0.39, "Colossal Sword": 0.57 },
            34: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.04, "Great Axe": 0.38, "Colossal Sword": 0.58 },
            35: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.04, "Great Axe": 0.37, "Colossal Sword": 0.59 },
            36: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.03, "Great Axe": 0.36, "Colossal Sword": 0.61 },
            37: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.03, "Great Axe": 0.35, "Colossal Sword": 0.62 },
            38: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.03, "Great Axe": 0.34, "Colossal Sword": 0.63 },
            39: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.03, "Great Axe": 0.33, "Colossal Sword": 0.64 },
            40: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.03, "Great Axe": 0.32, "Colossal Sword": 0.65 },
            41: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.03, "Great Axe": 0.32, "Colossal Sword": 0.65 },
            42: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.03, "Great Axe": 0.31, "Colossal Sword": 0.66 },
            43: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.31, "Colossal Sword": 0.67 },
            44: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.3, "Colossal Sword": 0.68 },
            45: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.3, "Colossal Sword": 0.68 },
            46: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.29, "Colossal Sword": 0.69 },
            47: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.29, "Colossal Sword": 0.69 },
            48: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.28, "Colossal Sword": 0.7 },
            49: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.28, "Colossal Sword": 0.7 },
            50: { "Dagger": 0, "Straight Sword": 0, "Mace": 0, "Axe": 0, "Spear": 0.02, "Great Axe": 0.28, "Colossal Sword": 0.7 }
        };

        // Armor probability data
        const armorProbabilities = {
            3: { "Light Helmet": 1.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            4: { "Light Helmet": 1.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            5: { "Light Helmet": 0.89, "Light Leggings": 0.11, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            6: { "Light Helmet": 0.56, "Light Leggings": 0.44, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            7: { "Light Helmet": 0.32, "Light Leggings": 0.67, "Light Chestplate": 0.01, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            8: { "Light Helmet": 0.16, "Light Leggings": 0.67, "Light Chestplate": 0.17, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            9: { "Light Helmet": 0.08, "Light Leggings": 0.51, "Light Chestplate": 0.41, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            10: { "Light Helmet": 0.04, "Light Leggings": 0.34, "Light Chestplate": 0.53, "Medium Helmet": 0.09, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            11: { "Light Helmet": 0.02, "Light Leggings": 0.2, "Light Chestplate": 0.47, "Medium Helmet": 0.31, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            12: { "Light Helmet": 0.01, "Light Leggings": 0.12, "Light Chestplate": 0.37, "Medium Helmet": 0.5, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            13: { "Light Helmet": 0, "Light Leggings": 0.07, "Light Chestplate": 0.28, "Medium Helmet": 0.6, "Medium Leggings": 0.04, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            14: { "Light Helmet": 0, "Light Leggings": 0.04, "Light Chestplate": 0.19, "Medium Helmet": 0.55, "Medium Leggings": 0.22, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            15: { "Light Helmet": 0, "Light Leggings": 0.02, "Light Chestplate": 0.12, "Medium Helmet": 0.43, "Medium Leggings": 0.43, "Medium Chestplate": 0, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            16: { "Light Helmet": 0, "Light Leggings": 0.01, "Light Chestplate": 0.08, "Medium Helmet": 0.32, "Medium Leggings": 0.57, "Medium Chestplate": 0.02, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            17: { "Light Helmet": 0, "Light Leggings": 0.01, "Light Chestplate": 0.05, "Medium Helmet": 0.22, "Medium Leggings": 0.57, "Medium Chestplate": 0.16, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            18: { "Light Helmet": 0, "Light Leggings": 0, "Light Chestplate": 0.03, "Medium Helmet": 0.14, "Medium Leggings": 0.48, "Medium Chestplate": 0.35, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            19: { "Light Helmet": 0, "Light Leggings": 0, "Light Chestplate": 0.02, "Medium Helmet": 0.09, "Medium Leggings": 0.39, "Medium Chestplate": 0.5, "Heavy Helmet": 0, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            20: { "Light Helmet": 0, "Light Leggings": 0, "Light Chestplate": 0.01, "Medium Helmet": 0.06, "Medium Leggings": 0.32, "Medium Chestplate": 0.6, "Heavy Helmet": 0.01, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            21: { "Light Helmet": 0, "Light Leggings": 0, "Light Chestplate": 0.01, "Medium Helmet": 0.04, "Medium Leggings": 0.25, "Medium Chestplate": 0.63, "Heavy Helmet": 0.07, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            22: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0.03, "Medium Leggings": 0.19, "Medium Chestplate": 0.59, "Heavy Helmet": 0.19, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            23: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0.02, "Medium Leggings": 0.14, "Medium Chestplate": 0.52, "Heavy Helmet": 0.32, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            24: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0.01, "Medium Leggings": 0.11, "Medium Chestplate": 0.44, "Heavy Helmet": 0.44, "Heavy Leggings": 0, "Heavy Chestplate": 0 },
            25: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0.01, "Medium Leggings": 0.07, "Medium Chestplate": 0.36, "Heavy Helmet": 0.51, "Heavy Leggings": 0.05, "Heavy Chestplate": 0 },
            26: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0.01, "Medium Leggings": 0.05, "Medium Chestplate": 0.28, "Heavy Helmet": 0.51, "Heavy Leggings": 0.15, "Heavy Chestplate": 0 },
            27: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0.04, "Medium Chestplate": 0.21, "Heavy Helmet": 0.47, "Heavy Leggings": 0.28, "Heavy Chestplate": 0 },
            28: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0.03, "Medium Chestplate": 0.16, "Heavy Helmet": 0.42, "Heavy Leggings": 0.39, "Heavy Chestplate": 0 },
            29: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0.02, "Medium Chestplate": 0.11, "Heavy Helmet": 0.35, "Heavy Leggings": 0.48, "Heavy Chestplate": 0.04 },
            30: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0.01, "Medium Chestplate": 0.08, "Heavy Helmet": 0.28, "Heavy Leggings": 0.50, "Heavy Chestplate": 0.13 },
            31: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0.01, "Medium Chestplate": 0.06, "Heavy Helmet": 0.22, "Heavy Leggings": 0.46, "Heavy Chestplate": 0.25 },
            32: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0.01, "Medium Chestplate": 0.04, "Heavy Helmet": 0.17, "Heavy Leggings": 0.42, "Heavy Chestplate": 0.36 },
            33: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.03, "Heavy Helmet": 0.13, "Heavy Leggings": 0.37, "Heavy Chestplate": 0.47 },
            34: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.02, "Heavy Helmet": 0.1, "Heavy Leggings": 0.33, "Heavy Chestplate": 0.55 },
            35: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.02, "Heavy Helmet": 0.08, "Heavy Leggings": 0.3, "Heavy Chestplate": 0.6 },
            36: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.01, "Heavy Helmet": 0.07, "Heavy Leggings": 0.27, "Heavy Chestplate": 0.65 },
            37: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.01, "Heavy Helmet": 0.06, "Heavy Leggings": 0.25, "Heavy Chestplate": 0.68 },
            38: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.01, "Heavy Helmet": 0.05, "Heavy Leggings": 0.23, "Heavy Chestplate": 0.71 },
            39: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.01, "Heavy Helmet": 0.04, "Heavy Leggings": 0.22, "Heavy Chestplate": 0.73 },
            40: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.01, "Heavy Helmet": 0.04, "Heavy Leggings": 0.2, "Heavy Chestplate": 0.75 },
            41: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0.01, "Heavy Helmet": 0.04, "Heavy Leggings": 0.19, "Heavy Chestplate": 0.77 },
            42: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.03, "Heavy Leggings": 0.18, "Heavy Chestplate": 0.79 },
            43: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.03, "Heavy Leggings": 0.17, "Heavy Chestplate": 0.8 },
            44: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.03, "Heavy Leggings": 0.17, "Heavy Chestplate": 0.8 },
            45: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.03, "Heavy Leggings": 0.16, "Heavy Chestplate": 0.81 },
            46: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.02, "Heavy Leggings": 0.16, "Heavy Chestplate": 0.82 },
            47: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.02, "Heavy Leggings": 0.15, "Heavy Chestplate": 0.83 },
            48: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.02, "Heavy Leggings": 0.15, "Heavy Chestplate": 0.83 },
            49: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.02, "Heavy Leggings": 0.14, "Heavy Chestplate": 0.84 },
            50: { "Light Helmet": 0.0, "Light Leggings": 0, "Light Chestplate": 0, "Medium Helmet": 0, "Medium Leggings": 0, "Medium Chestplate": 0, "Heavy Helmet": 0.02, "Heavy Leggings": 0.14, "Heavy Chestplate": 0.84 },
        };

        const specificItemVariants = {
            weapon: {
                "Dagger": {
                    "stonewake": [
                        { name: "Dagger", chance: "1/1", probability: 1.0 },
                        { name: "Falchion Knife", chance: "1/2", probability: 0.5 },
                        { name: "Gladius Dagger", chance: "1/16", probability: 0.0625 }
                    ],
                    "kingdom": [
                        { name: "Dagger", chance: "1/1", probability: 1.0 },
                        { name: "Gladius Dagger", chance: "1/4", probability: 0.25 },
                        { name: "Hook", chance: "1/16", probability: 0.0625 }
                    ],
                    "frostspire": [
                        { name: "Dagger", chance: "1/1", probability: 1.0 },
                        { name: "Gladius Dagger", chance: "1/4", probability: 0.25 },
                        { name: "Hook", chance: "1/16", probability: 0.0625 }
                    ]
                },
                "Straight Sword": {
                    "stonewake": [
                        { name: "Gladius", chance: "1/1", probability: 1.0 },
                        { name: "Falchion", chance: "1/3", probability: 0.3333 },
                        { name: "Cutlass", chance: "1/8", probability: 0.125 }
                    ],
                    "kingdom": [
                        { name: "Falchion", chance: "1/1", probability: 1.0 },
                        { name: "Cutlass", chance: "1/2", probability: 0.5 },
                        { name: "Rapier", chance: "1/4", probability: 0.25 },
                        { name: "Chaos", chance: "1/16", probability: 0.0625 }
                    ],
                    "frostspire": [
                        { name: "Falchion", chance: "1/1", probability: 1.0 },
                        { name: "Cutlass", chance: "1/2", probability: 0.5 },
                        { name: "Rapier", chance: "1/4", probability: 0.25 },
                        { name: "Chaos", chance: "1/16", probability: 0.0625 },
                        { name: "Hell Slayer", chance: "1/20", probability: 0.0625 }
                    ]
                },
                "Gauntlet": {
                    "stonewake": [
                        { name: "Ironhand", chance: "1/1", probability: 1.0 },
                        { name: "Boxing Gloves", chance: "1/4", probability: 0.25 }
                    ],
                    "kingdom": [
                        { name: "Ironhand", chance: "1/1", probability: 1.0 },
                        { name: "Relevator", chance: "1/4", probability: 0.25 },
                        { name: "Savage Claws", chance: "1/4", probability: 0.25 }
                    ]
                },
                "Katana": {
                    "stonewake": [
                        { name: "Uchigatana", chance: "1/1", probability: 1.0 }
                    ],
                    "kingdom": [
                        { name: "Uchigatana", chance: "1/1", probability: 1.0 },
                        { name: "Tachi", chance: "1/4", probability: 0.25 }
                    ]
                },
                "Great Sword": {
                    "stonewake": [
                        { name: "Crusader Sword", chance: "1/1", probability: 1.0 }
                    ],
                    "kingdom": [
                        { name: "Crusader Sword", chance: "1/1", probability: 1.0 },
                        { name: "Long Sword", chance: "1/2", probability: 0.5 }
                    ]
                },
                "Mace": {
                    "frostspire": [
                        { name: "Mace", chance: "1/1", probability: 1.0 },
                        { name: "Spiked Mace", chance: "1/2", probability: 0.5 },
                        { name: "Winged Mace", chance: "1/4", probability: 0.25 },
                        { name: "Hammerhead Mace", chance: "1/8", probability: 0.125 },
                        { name: "Grave Maker", chance: "1/16", probability: 0.0625 }
                    ]
                },
                "Axe": {
                    "frostspire": [
                        { name: "Axe", chance: "1/1", probability: 1.0 },
                        { name: "Battleaxe", chance: "1/2", probability: 0.5 },
                        { name: "Curved Handle Axe", chance: "1/4", probability: 0.25 },
                        { name: "Spade Armed Axe", chance: "1/8", probability: 0.125 }
                    ]
                },
                "Spear": {
                    "frostspire": [
                        { name: "Spear", chance: "1/1", probability: 1.0 },
                        { name: "Trident", chance: "1/2", probability: 0.5 },
                        { name: "Demonic Spear", chance: "1/4", probability: 0.25 },
                        { name: "Angelic Spear", chance: "1/8", probability: 0.125 }
                    ]
                },
                "Great Axe": {
                    "stonewake": [
                        { name: "Double Battle Axe", chance: "1/1", probability: 1.0 }
                    ],
                    "kingdom": [
                        { name: "Double Battle Axe", chance: "1/1", probability: 1.0 },
                        { name: "Scythe", chance: "1/4", probability: 0.25 }
                    ],
                    "frostspire": [
                        { name: "Double Battle Axe", chance: "1/1", probability: 1.0 },
                        { name: "Scythe", chance: "1/4", probability: 0.25 },
                        { name: "Greater Battle Axe", chance: "1/4", probability: 0.0625 },
                        { name: "Wyvern Axe", chance: "1/4", probability: 0.0625 }

                    ]
                },
                "Colossal Sword": {
                    "stonewake": [
                        { name: "Great Sword", chance: "1/1", probability: 1.0 },
                        { name: "Hammer", chance: "1/4", probability: 0.25 },
                        { name: "Comically Large Spoon", chance: "1/16", probability: 0.0625 }
                    ],
                    "kingdom": [
                        { name: "Great Sword", chance: "1/1", probability: 1.0 },
                        { name: "Hammer", chance: "1/4", probability: 0.25 },
                        { name: "Skull Crusher", chance: "1/8", probability: 0.125 },
                        { name: "Dragon Slayer", chance: "1/16", probability: 0.0625 }
                    ],
                    "frostspire": [
                        { name: "Great Sword", chance: "1/1", probability: 1.0 },
                        { name: "Hammer", chance: "1/4", probability: 0.25 },
                        { name: "Skull Crusher", chance: "1/8", probability: 0.125 },
                        { name: "Dragon Slayer", chance: "1/16", probability: 0.0625 }
                    ]
                }
            },
            armor: {
                "Light Helmet": {
                    "stonewake": [{ name: "Light Helmet", chance: "1/1", probability: 1.0 }],
                    "kingdom": [{ name: "Light Helmet", chance: "1/1", probability: 1.0 }],
                    "frostspire": [{ name: "Light Helmet", chance: "1/1", probability: 1.0 }]
                },
                "Light Leggings": {
                    "stonewake": [{ name: "Light Leggings", chance: "1/1", probability: 1.0 }],
                    "kingdom": [{ name: "Light Leggings", chance: "1/1", probability: 1.0 }],
                    "frostspire": [{ name: "Light Leggings", chance: "1/1", probability: 1.0 }]
                },
                "Light Chestplate": {
                    "stonewake": [{ name: "Light Chestplate", chance: "1/1", probability: 1.0 }],
                    "kingdom": [{ name: "Light Chestplate", chance: "1/1", probability: 1.0 }],
                    "frostspire": [{ name: "Light Chestplate", chance: "1/1", probability: 1.0 }]
                },
                "Medium Helmet": {
                    "stonewake": [{ name: "Medium Helmet", chance: "1/1", probability: 1.0 }],
                    "kingdom": [
                        { name: "Medium Helmet", chance: "1/1", probability: 1.0 },
                        { name: "Samurai Helmet", chance: "1/2", probability: 0.5 }
                    ],
                    "frostspire": [
                        { name: "Medium Helmet", chance: "1/1", probability: 1.0 },
                        { name: "Samurai Helmet", chance: "1/2", probability: 0.5 },
                        { name: "Viking Helmet", chance: "1/4", probability: 0.25 }
                    ]
                },
                "Medium Leggings": {
                    "stonewake": [{ name: "Medium Leggings", chance: "1/1", probability: 1.0 }],
                    "kingdom": [
                        { name: "Medium Leggings", chance: "1/1", probability: 1.0 },
                        { name: "Samurai Leggings", chance: "1/2", probability: 0.5 }
                    ],
                    "frostspire": [
                        { name: "Medium Leggings", chance: "1/1", probability: 1.0 },
                        { name: "Samurai Leggings", chance: "1/2", probability: 0.5 },
                        { name: "Viking Leggings", chance: "1/4", probability: 0.25 }
                    ]
                },
                "Medium Chestplate": {
                    "stonewake": [{ name: "Medium Chestplate", chance: "1/1", probability: 1.0 }],
                    "kingdom": [
                        { name: "Medium Chestplate", chance: "1/1", probability: 1.0 },
                        { name: "Samurai Chestplate", chance: "1/2", probability: 0.5 }
                    ],
                    "frostspire": [
                        { name: "Medium Chestplate", chance: "1/1", probability: 1.0 },
                        { name: "Samurai Chestplate", chance: "1/2", probability: 0.5 },
                        { name: "Viking Chestplate", chance: "1/4", probability: 0.25 }
                    ]
                },
                "Heavy Helmet": {
                    "stonewake": [{ name: "Knight Helmet", chance: "1/1", probability: 1.0 }],
                    "kingdom": [
                        { name: "Knight Helmet", chance: "1/1", probability: 1.0 },
                        { name: "Dark Knight Helmet", chance: "1/2", probability: 0.5 }
                    ],
                    "frostspire": [
                        { name: "Knight Helmet", chance: "1/1", probability: 1.0 },
                        { name: "Dark Knight Helmet", chance: "1/2", probability: 0.5 },
                        { name: "Wolf Helmet", chance: "1/4", probability: 0.25 }
                    ]
                },
                "Heavy Leggings": {
                    "stonewake": [{ name: "Knight Leggings", chance: "1/1", probability: 1.0 }],
                    "kingdom": [
                        { name: "Knight Leggings", chance: "1/1", probability: 1.0 },
                        { name: "Dark Knight Leggings", chance: "1/2", probability: 0.5 }
                    ],
                    "frostspire": [
                        { name: "Knight Leggings", chance: "1/1", probability: 1.0 },
                        { name: "Dark Knight Leggings", chance: "1/2", probability: 0.5 },
                        { name: "Wolf Leggings", chance: "1/4", probability: 0.25 }
                    ]
                },
                "Heavy Chestplate": {
                    "stonewake": [{ name: "Knight Chestplate", chance: "1/1", probability: 1.0 }],
                    "kingdom": [
                        { name: "Knight Chestplate", chance: "1/1", probability: 1.0 },
                        { name: "Dark Knight Chestplate", chance: "1/2", probability: 0.5 }
                    ],
                    "frostspire": [
                        { name: "Knight Chestplate", chance: "1/1", probability: 1.0 },
                        { name: "Dark Knight Chestplate", chance: "1/2", probability: 0.5 },
                        { name: "Wolf Chestplate", chance: "1/4", probability: 0.25 }
                    ]
                }
            }
        };

        // Optimal ore counts for each item type
        const optimalCounts = {
            weapon: {
                "Dagger": 3,
                "Straight Sword": 6,
                "Gauntlet": 9,
                "Katana": 12,
                "Great Sword": 16,
                "Great Axe": 22,
                "Colossal Sword": 36
            },
            armor: {
                "Light Helmet": 3,
                "Light Leggings": 7,
                "Light Chestplate": 10,
                "Medium Helmet": 13,
                "Medium Leggings": 16,
                "Medium Chestplate": 21,
                "Heavy Helmet": 26,
                "Heavy Leggings": 30,
                "Heavy Chestplate": 40
            }
        };

        const optimalCountsFrostspire = {
            weapon: {
                "Dagger": 3,
                "Straight Sword": 6,
                "Mace": 9,
                "Axe": 12,
                "Spear": 16,
                "Great Axe": 22,
                "Colossal Sword": 36
            },
            armor: optimalCounts.armor
        };

        let currentMode = 'weapon';
        let oreMix = [];
        let activeFilter = 'all';

        let quickCraftType = null;
        let quickCraftItem = null;
        let selectedTraits = [];
        let currentStep = 0;
        let currentArea = 'frostspire';
        let highestProbabilityItem = null;
        let forgedItems = JSON.parse(localStorage.getItem('forgedItems') || '[]');
        const MAX_INVENTORY_SIZE = 20;
        let currentSearchTerm = '';
        let isQuickCraft = false;
        let quickCraftTargetItem = null;
        let selectedPreviewVariant = { baseItemType: null, variantName: null };
        const oreSearchInput = document.getElementById('ore-search');
        const filtersToggle = document.getElementById('filters-toggle');
        const filtersDropdown = document.getElementById('filters-dropdown');
        const filterOptions = document.querySelectorAll('.filter-option');
        const oreInventory = document.getElementById('ore-inventory');
        const oreSlotsContainer = document.getElementById('ore-slots');
        const probabilityList = document.getElementById('probability-list');
        const activeTraitsContainer = document.getElementById('active-traits');
        const multiplierValue = document.getElementById('multiplier-value');
        const totalOresDisplay = document.getElementById('total-ores');
        const weaponToggle = document.getElementById('weapon-toggle');
        const armorToggle = document.getElementById('armor-toggle');
        const resetBtn = document.getElementById('reset-btn');
        const forgeBtn = document.getElementById('forge-btn');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const quickCraftBtn = document.getElementById('quick-craft-btn');
        const quickCraftModal = document.getElementById('quick-craft-modal');
        const modalClose = document.getElementById('modal-close');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const craftBtn = document.getElementById('craft-btn');
        const stepType = document.getElementById('step-type');
        const stepItem = document.getElementById('step-item');
        const stepTraits = document.getElementById('step-traits');
        const stepSummary = document.getElementById('step-summary');
        const itemOptions = document.getElementById('item-options');
        const traitOptions = document.getElementById('trait-options');
        const summaryContent = document.getElementById('summary-content');
        const inventoryBtn = document.getElementById('inventory-btn');
        const inventoryModal = document.getElementById('inventory-modal');
        const inventoryClose = document.getElementById('inventory-close');
        const closeInventoryBtn = document.getElementById('close-inventory-btn');
        const clearInventoryBtn = document.getElementById('clear-inventory-btn');
        const inventoryCards = document.getElementById('inventory-cards');
        const totalForged = document.getElementById('total-forged');
        const totalValue = document.getElementById('total-value');

        function init() {
            renderOreInventory();
            updateOreSlots();
            updateProbabilities();
            setupEventListeners();
            setupQuickCraft();
            updateItemPreview();
            updateAreaToggle();
            setupForgeResultModal();
            setupInventorySystem();
            setupFiltersDropdown();
        }

        document.getElementById('tooltip-close').addEventListener('click', () => {
            document.getElementById('variant-tooltip').style.display = 'none';
        });

        document.addEventListener('click', (e) => {
            const tooltip = document.getElementById('variant-tooltip');
            if (tooltip.style.display === 'block' && !tooltip.contains(e.target) && !e.target.closest('.probability-item')) {
                tooltip.style.display = 'none';
            }
        });

        function saveForgedItem(result) {
            const inventoryItem = {
                id: Date.now(),
                itemName: result.itemName,
                itemType: result.itemType,
                variant: result.variant,
                multiplier: result.multiplier,
                mainOre: result.mainOre,
                stats: result.stats,
                traits: result.traits,
                area: result.area,
                totalOres: result.totalOres,
                timestamp: new Date().toLocaleString(),
                mode: currentMode,
                image: itemImages[result.itemName] || ''
            };

            forgedItems.unshift(inventoryItem);

            if (forgedItems.length > MAX_INVENTORY_SIZE) {
                forgedItems = forgedItems.slice(0, MAX_INVENTORY_SIZE);
            }

            localStorage.setItem('forgedItems', JSON.stringify(forgedItems));

            updateInventoryUI();
        }

        function updateInventoryUI() {

            const totalItems = forgedItems.length;
            const totalValueSum = forgedItems.reduce((sum, item) => sum + (item.stats?.price || 0), 0);

            totalForged.textContent = `Total Items Forged: ${totalItems}`;
            totalValue.textContent = `Total Value: $${Math.round(totalValueSum)}`;

            renderInventoryCards();
        }

        function renderInventoryCards() {
            inventoryCards.innerHTML = '';

            if (forgedItems.length === 0) {
                inventoryCards.innerHTML = `
            <div class="inventory-empty">
                <i class="fas fa-box-open"></i>
                <p>No items forged yet. Start forging to see your history!</p>
            </div>
        `;
                return;
            }

            forgedItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'inventory-card';

                const oreColor = item.mainOre?.color || (currentMode === 'weapon' ? '#FF6600' : '#19b9b9');

                let statsHTML = '';
                if (item.mode === 'weapon') {
                    statsHTML = `
                <div class="inventory-stat-row">
                    <span class="inventory-stat-label">
                        <i class="fas fa-fan"></i> Damage
                    </span>
                    <span class="inventory-stat-value" style="color: var(--primary);">
                        ${item.stats.damage?.toFixed(2) || '0.00'}
                    </span>
                </div>
                <div class="inventory-stat-row">
                    <span class="inventory-stat-label">
                        <i class="fas fa-bolt"></i> Attack Speed
                    </span>
                    <span class="inventory-stat-value" style="color: var(--rare);">
                        ${item.stats.atkSpeed?.toFixed(2) || '0.00'}s
                    </span>
                </div>
                <div class="inventory-stat-row">
                    <span class="inventory-stat-label">
                        <i class="fas fa-ruler"></i> Range
                    </span>
                    <span class="inventory-stat-value" style="color: var(--relic)">
                        ${item.stats.range || '0'} studs
                    </span>
                </div>
                <div class="inventory-stat-row">
                    <span class="inventory-stat-label">
                        <i class="fas fa-coins"></i> Value
                    </span>
                    <span class="inventory-stat-value" style="color: gold;">
                        $${Math.round(item.stats.price) || '0'}
                    </span>
                </div>
            `;
                } else {
                    statsHTML = `
                <div class="inventory-stat-row">
                    <span class="inventory-stat-label">
                        <i class="fas fa-heart"></i> Health Bonus
                    </span>
                    <span class="inventory-stat-value" style="color: var(--success);">
                        +${item.stats.health?.toFixed(2) || '0'}%
                    </span>
                </div>
                <div class="inventory-stat-row">
                    <span class="inventory-stat-label">
                        <i class="fas fa-shield-alt"></i> DEF
                    </span>
                    <span class="inventory-stat-value" style="color: var(--primary);">
                        ${Math.round(item.stats.def) || '0'}
                    </span>
                </div>
                <div class="inventory-stat-row">
                    <span class="inventory-stat-label">
                        <i class="fas fa-coins"></i> Value
                    </span>
                    <span class="inventory-stat-value" style="color: gold;">
                        $${Math.round(item.stats.price) || '0'}
                    </span>
                </div>
            `;
                }

                let traitsHTML = '';
                if (item.traits && item.traits.length > 0) {
                    item.traits.forEach((trait, index) => {
                        const iconClass = getTraitIconClass(trait.oreId);
                        traitsHTML += `
                    <div class="trait-icon" style="border-color: ${trait.oreColor || oreColor}; background: ${trait.oreColor || oreColor}30;">
                        <i class="${iconClass}"></i>
                        <div class="trait-tooltip">
                            <strong style="color: ${trait.oreColor || oreColor};">
                                <i class="fas ${iconClass}" style="color: ${trait.oreColor || oreColor};"></i>
                                ${trait.oreName}
                            </strong>
                            <p>${formatTraitDescription(trait.description)}</p>
                        </div>
                    </div>
                `;
                    });
                }

                card.innerHTML = `
            <div class="inventory-card-header" style="border-color: ${oreColor}40;">
                <div class="forge-result-image" style="border-color: ${oreColor}; background-image: url('${item.image}'); width: 120px; height: 90px;"></div>
                <div style="flex-grow: 1; margin-left: 10px;">
                    <div class="inventory-card-ore">
                        <i class="fas fa-gem" style="color: ${oreColor};"></i>
                        <span style="color: ${oreColor};">${item.mainOre?.name || 'Unknown Ore'}</span>
                    </div>
                    <div class="inventory-card-item" style="color: ${oreColor};">${item.itemName}</div>
                </div>
            </div>
            
            <div class="inventory-card-stats" style="border-color: ${oreColor}40;">
                ${statsHTML}
            </div>
            
            ${traitsHTML ? `
                <div class="inventory-card-traits">
                    ${traitsHTML}
                </div>
            ` : ''}
        `;

                card.style.border = `2px solid ${oreColor}40`;
                card.style.setProperty('--ore-color', oreColor);
                card.style.setProperty('--ore-color-light', `${oreColor}10`);

                inventoryCards.appendChild(card);
            });
        }

        function formatTraitDescription(description) {
            return description.replace(
                /([-+]?\d+(?:\.\d+)?)(\s*[+%a-zA-Z]*)/g,
                '<span class="scalable-value">$1<span class="scalable-symbol">$2</span></span>'
            );
        }

        function getTraitIconClass(oreId) {
            if (!oreId) return 'fas fa-gem';

            if (traitIconMapping[oreId]) {
                return traitIconMapping[oreId].icon;
            }

            const ore = oreData.find(o => o.id === oreId);
            if (!ore) return 'fas fa-gem';

            const lowerName = ore.name.toLowerCase();

            if (lowerName.includes('fire') || lowerName.includes('magma')) return 'fas fa-fire';
            if (lowerName.includes('demon') || lowerName.includes('dark')) return 'fas fa-ghost';
            if (lowerName.includes('light') || lowerName.includes('aetherit') || lowerName.includes('velchire')) return 'fas fa-running';
            if (lowerName.includes('myth') || lowerName.includes('obsidian') || lowerName.includes('pumice') || lowerName.includes('etheralite') || lowerName.includes('mosasaursit')) return 'fas fa-heart';
            if (lowerName.includes('rival') || lowerName.includes('voidstar')) return 'fas fa-crosshairs';
            if (lowerName.includes('uranium') || lowerName.includes('poop') || lowerName.includes('malachite')) return 'fas fa-skull-crossbones';
            if (lowerName.includes('eye') || lowerName.includes('frost fossil') || lowerName.includes('crimsonite')) return 'fas fa-fan';
            if (lowerName.includes('graphite') || lowerName.includes('sanctis')) return 'fas fa-shield';
            if (lowerName.includes('snowite') || lowerName.includes('iceite')) return 'fas fa-snowflake';

            return 'fas fa-gem';
        }

        function clearInventory() {
            if (forgedItems.length > 0) {
                forgedItems = [];
                localStorage.removeItem('forgedItems');
                updateInventoryUI();
            }
        }

        function setupInventorySystem() {
            inventoryBtn.addEventListener('click', () => {
                inventoryModal.style.display = 'flex';
                setTimeout(() => inventoryModal.classList.add('show'), 10);

                if (window.innerWidth <= 480) {
                    document.body.classList.add('modal-open');
                }

                updateInventoryUI();
            });

            function closeInventoryModal() {
                inventoryModal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    inventoryModal.style.display = 'none';
                    inventoryModal.classList.remove('show');
                    inventoryModal.style.animation = '';
                    document.body.classList.remove('modal-open');
                }, 300);
            }

            inventoryClose.addEventListener('click', closeInventoryModal);
            closeInventoryBtn.addEventListener('click', closeInventoryModal);

            inventoryModal.addEventListener('click', (e) => {
                if (e.target === inventoryModal) {
                    closeInventoryModal();
                }
            });

            clearInventoryBtn.addEventListener('click', clearInventory);

            updateInventoryUI();
        }

        function updateItemPreview() {
            const previewContainer = document.getElementById('item-preview-container');
            const previewPlaceholder = document.getElementById('forge-preview-placeholder');
            const previewCard = document.getElementById('forge-preview-card');

            const totalOres = oreMix.reduce((sum, item) => sum + item.count, 0);

            if (totalOres < 3) {
                previewPlaceholder.style.display = 'block';
                previewCard.style.display = 'none';
                previewContainer.classList.remove('has-preview');
                return;
            }

            let multiplierSum = 0;
            oreMix.forEach(item => {
                const ore = oreData.find(o => o.id === item.id);
                multiplierSum += ore.multiplier * item.count;
            });
            const multiplier = multiplierSum / totalOres;

            let probabilities;
            if (currentMode === 'weapon') {
                probabilities = currentArea === 'frostspire' ? weaponProbabilitiesFrostspire : weaponProbabilities;
            } else {
                probabilities = armorProbabilities;
            }
            const counts = Object.keys(probabilities).map(Number);
            const closestCount = counts.reduce((prev, curr) => {
                return (Math.abs(curr - totalOres) < Math.abs(prev - totalOres) ? curr : prev);
            });

            const currentProbs = probabilities[closestCount] || {};
            let highestProb = 0;
            let highestItem = null;

            Object.entries(currentProbs).forEach(([itemName, probability]) => {
                if (probability > highestProb) {
                    highestProb = probability;
                    highestItem = itemName;
                }
            });

            if (!highestItem) {
                previewPlaceholder.style.display = 'block';
                previewCard.style.display = 'none';
                return;
            }

            if (selectedPreviewVariant.baseItemType && selectedPreviewVariant.baseItemType !== highestItem) {
                selectedPreviewVariant = { baseItemType: null, variantName: null };
            }

            let baseItemName;

            if (selectedPreviewVariant.baseItemType === highestItem && selectedPreviewVariant.variantName) {
                baseItemName = selectedPreviewVariant.variantName;
            } else {
                baseItemName = Object.keys(baseItemStats[currentMode]).find(name => {
                    const itemData = baseItemStats[currentMode][name];
                    return itemData.type === highestItem;
                });

                if (!baseItemName && currentMode === 'armor') {
                    baseItemName = Object.keys(baseItemStats.armor).find(name => {
                        const itemData = baseItemStats.armor[name];
                        return itemData.type === highestItem;
                    });
                }
            }

            if (!baseItemName) return;

            const baseStats = baseItemStats[currentMode][baseItemName];
            const scaledStats = {
                ...baseStats
            };

            if (currentMode === 'weapon') {
                scaledStats.damage = baseStats.damage * multiplier;
                scaledStats.price = baseStats.price * multiplier;
            } else {
                scaledStats.def = baseStats.def * multiplier;
                scaledStats.price = baseStats.price * multiplier;
            }

            const activeTraits = getActiveTraits();
            const mainOre = getMainOre();
            const oreColor = mainOre ? mainOre.color : 'var(--primary)';

            previewPlaceholder.style.display = 'none';
            previewCard.style.display = 'flex';
            previewContainer.classList.add('has-preview');

            const itemImage = itemImages[baseItemName] || '';

            let traitsHTML = '';
            if (activeTraits.length > 0) {
                traitsHTML = `
            <div class="inventory-card-traits">
                ${activeTraits.map((trait, index) => {
                    const iconClass = getTraitIconClass(trait.oreId);
                    return `
                        <div class="trait-icon" style="border-color: ${trait.oreColor || oreColor}; background: ${trait.oreColor || oreColor}30;">
                            <i class="${iconClass}"></i>
                            <div class="trait-tooltip">
                                <strong style="color: ${trait.oreColor || oreColor};">
                                    <i class="fas ${iconClass}" style="color: ${trait.oreColor || oreColor};"></i>
                                    ${trait.oreName}
                                </strong>
                                <p>${formatTraitDescription(trait.description)}</p>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
            }

            let statsHTML = '';
            if (currentMode === 'weapon') {
                statsHTML = `
            <div class="inventory-stat-row">
                <span class="inventory-stat-label">
                    <i class="fas fa-fan"></i> Damage
                </span>
                <span class="inventory-stat-value" style="color: var(--primary);">
                    ${scaledStats.damage.toFixed(2) || '0.00'}
                </span>
            </div>
            <div class="inventory-stat-row">
                <span class="inventory-stat-label">
                    <i class="fas fa-bolt"></i> Attack Speed
                </span>
                <span class="inventory-stat-value" style="color: var(--rare);">
                    ${scaledStats.atkSpeed.toFixed(2) || '0.00'}s
                </span>
            </div>
            <div class="inventory-stat-row">
                <span class="inventory-stat-label">
                    <i class="fas fa-ruler"></i> Range
                </span>
                <span class="inventory-stat-value" style="color: var(--relic)">
                    ${scaledStats.range || '0'} studs
                </span>
            </div>
            <div class="inventory-stat-row">
                <span class="inventory-stat-label">
                    <i class="fas fa-coins"></i> Value
                </span>
                <span class="inventory-stat-value" style="color: gold;">
                    $${Math.round(scaledStats.price) || '0'}
                </span>
            </div>
        `;
            } else {
                statsHTML = `
            <div class="inventory-stat-row">
                <span class="inventory-stat-label">
                    <i class="fas fa-heart"></i> Health Bonus
                </span>
                <span class="inventory-stat-value" style="color: var(--success);">
                    +${scaledStats.health.toFixed(2) || '0'}%
                </span>
            </div>
            <div class="inventory-stat-row">
                <span class="inventory-stat-label">
                    <i class="fas fa-shield-alt"></i> DEF
                </span>
                <span class="inventory-stat-value" style="color: var(--primary);">
                    ${Math.round(scaledStats.def) || '0'}
                </span>
            </div>
            <div class="inventory-stat-row">
                <span class="inventory-stat-label">
                    <i class="fas fa-coins"></i> Value
                </span>
                <span class="inventory-stat-value" style="color: gold;">
                    $${Math.round(scaledStats.price) || '0'}
                </span>
            </div>
        `;
            }

            previewCard.innerHTML = `
            <div class="preview-header" style="display: flex; align-items: center; flex-direction: column; margin-bottom: 10px; margin-top: -5px;">
            <span class="prediction-note" style="margin-top: 0;">(Just a preview, forge results may vary!)</span>
            </div>
        <div class="inventory-card-header" style="justify-content: space-between; border-color: ${oreColor}40; position: relative;">
            ${itemImage ? `
                <div class="forge-result-image" style="border-color: ${oreColor}; background-image: url('${itemImage}'); width: 120px; height: 90px;"></div>
            ` : ''}
            <div style="flex-grow: 1; margin-left: 10px; display: flex; flex-direction: column; align-items: flex-start; justify-content: center;">
                <div class="inventory-card-item" style="color: ${oreColor}; margin-bottom: 5px;">${mainOre?.name || 'Unknown Ore'} ${baseItemName}</div>
                <div style="display: flex; align-items: center; gap: 5px; position: relative; flex-wrap: wrap;">
                    <span style="color: var(--text-secondary);font-weight: bold; background: ${oreColor}20; padding: 2px 8px 2px 8px; border-radius: 10px; border: 1px solid ${oreColor}40;">
                        <div class="preview-tooltip-trigger" data-item-type="${highestItem}" style="cursor: pointer; color: ${oreColor}; font-size: 0.8rem;">
                        <i class="fas fa-info-circle"></i> ${highestItem}
<div class="preview-variant-tooltip" style="display: none; position: absolute; background: var(--card-bg); border: 1px solid ${oreColor}; border-radius: 8px; padding: 10px; min-width: 180px; max-width: 220px; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.5); left: -60px;">
                            <div style="font-weight: bold; color: ${oreColor}; margin-bottom: 5px; font-size: 0.8rem;">Available Variants</div>
                            <div style="color: var(--text-secondary); font-size: 0.75rem; line-height: 1.3;">
                                ${getPreviewTooltipContent(highestItem, oreColor)}
                            </div>
                        </div>
                    </div>
                    </span>
                    <span class="preview-multiplier" style="font-weight: bold; background: ${oreColor}20; color: ${oreColor}; font-size: 0.8rem; padding: 2px 8px; border-radius: 10px; border: 1px solid ${oreColor}40;">
                    ${multiplier.toFixed(2)}x
                </span>
                </div> 
            </div>
        </div>
        <div style="display: flex; gap: 15px; align-items: flex-start;">
            <div style="flex: 1;">
                <div class="inventory-card-stats" style="border-color: ${oreColor}40; margin-bottom: 0px;">
                    ${statsHTML}
                </div>
            </div>
        </div>
        
        ${traitsHTML}
        
        <div class="prediction-note">
            <i class="fas fa-info-circle"></i> <span style="font-weight: bold;">${(calculateFinalProbability(highestItem, highestProb) * 100).toFixed(1)}%</span> forge chance for the ${selectedPreviewVariant.variantName || highestItem} variant.
        </div
    `;

            previewCard.style.background = `linear-gradient(135deg, ${oreColor}15 0%, ${oreColor}08 25%, rgba(0,0,0,0.1) 50%, ${oreColor}08 75%, ${oreColor}15 100%)`;
            previewCard.style.borderColor = oreColor + '40';
            previewCard.style.setProperty('--ore-color', oreColor);

            const tooltipTrigger = previewCard.querySelector('.preview-tooltip-trigger');
            const tooltip = tooltipTrigger?.querySelector('.preview-variant-tooltip');

            tooltipTrigger.addEventListener('mouseenter', () => {
                tooltip.style.display = 'block';
            });
            tooltipTrigger.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });

            if (tooltipTrigger && tooltip) {
                tooltip.addEventListener('click', function (e) {
                    const variantOption = e.target.closest('.variant-option');
                    if (variantOption) {
                        e.preventDefault();
                        e.stopPropagation();

                        const variantName = variantOption.dataset.variantName;
                        const baseType = variantOption.dataset.baseType;

                        selectPreviewVariant(baseType, variantName);
                    }
                });
            }
        }

        function resetPreviewSelection() {
            selectedPreviewVariant = { baseItemType: null, variantName: null };
            updateItemPreview();
        }



        function calculateFinalProbability(itemType, itemTypeProb) {
            const variants = specificItemVariants[currentMode]?.[itemType]?.[currentArea];

            if (!variants || variants.length === 0) {
                return itemTypeProb;
            }

            const totalWeight = variants.reduce((sum, variant) => sum + variant.probability, 0);

            if (totalWeight === 0) {
                return itemTypeProb;
            }

            let selectedVariant = null;
            if (selectedPreviewVariant.baseItemType === itemType && selectedPreviewVariant.variantName) {
                selectedVariant = variants.find(v => {
                    const cleanName = v.name.replace(/\s*\[.*?\]\s*/, '');
                    return cleanName === selectedPreviewVariant.variantName;
                });
            }

            if (!selectedVariant) {
                selectedVariant = variants[0];
            }

            return itemTypeProb * (selectedVariant.probability / totalWeight);
        }

        function getPreviewTooltipContent(itemType, color) {
            const variants = specificItemVariants[currentMode]?.[itemType]?.[currentArea];

            if (!variants || variants.length === 0) {
                return `<div style="color: var(--text-secondary);">No specific variants available</div>`;
            }

            if (!selectedPreviewVariant.baseItemType || selectedPreviewVariant.baseItemType !== itemType) {
                const firstVariant = variants[0];
                const cleanFirstName = firstVariant.name.replace(/\s*\[.*?\]\s*/, '');
                selectedPreviewVariant = { baseItemType: itemType, variantName: cleanFirstName };
            }

            let html = `<div style="display: flex; flex-direction: column; gap: 3px;">`;

            variants.forEach(variant => {
                const areaExclusive = variant.name.includes('[') ? variant.name.match(/\[(.*?)\]/)?.[1] : null;
                const cleanName = variant.name.replace(/\s*\[.*?\]\s*/, '');
                const probability = (variant.probability * 100).toFixed(1);
                const isSelected = (selectedPreviewVariant.baseItemType === itemType &&
                    selectedPreviewVariant.variantName === cleanName);

                html += `
            <div class="variant-option ${isSelected ? 'variant-selected' : ''}" 
                 data-variant-name="${cleanName}" 
                 data-base-type="${itemType}"
                 style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 6px 8px;
                    border-radius: 6px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    background: ${isSelected ? color + '30' : 'transparent'};
                    border: 1px solid ${isSelected ? color : 'transparent'};
                    border-bottom: 1px solid ${color};
                 "
                 onmouseover="this.style.background='${color}20'; this.style.transform='translateY(-1px)'"
                 onmouseout="this.style.background='${isSelected ? color + '30' : 'transparent'}'; this.style.transform='translateY(0px)'">
                <div style="
                    color: var(--text); 
                    font-weight: ${isSelected ? 'bold' : '600'}; 
                    font-size: 0.75rem;
                    display: flex;
                    align-items: center;
                    gap: 5px;">
                    ${cleanName}
                </div>
                <div style="
                    color: ${color}; 
                    font-weight: bold; 
                    font-size: 0.7rem; 
                    background: ${color}20; 
                    padding: 2px 6px; 
                    border-radius: 4px;">
                    ${variant.chance}
                </div>
            </div>
        `;
            });

            html += `</div>`;
            return html;
        }

        function selectPreviewVariant(baseItemType, variantName) {
            if (selectedPreviewVariant.baseItemType === baseItemType &&
                selectedPreviewVariant.variantName === variantName) {
                selectedPreviewVariant = { baseItemType: null, variantName: null };
            } else {
                selectedPreviewVariant = { baseItemType: baseItemType, variantName: variantName };
            }

            updateItemPreview();

            const tooltip = document.querySelector('.preview-variant-tooltip');
            if (tooltip) {
                tooltip.style.display = 'none';
            }
        }

        function getAreaDisplayName(area) {
            switch (area) {
                case 'kingdom': return 'Forgotten Kingdom';
                case 'stonewake': return 'Stonewake\'s Cross';
                case 'frostspire': return 'Frostspire Expanse';
                default: return 'Unknown Area';
            }
        }

        function showVariantTooltip(itemName, event, typeClass = '') {
            const tooltip = document.getElementById('variant-tooltip');
            const tooltipTitle = document.getElementById('tooltip-item-name');
            const tooltipContent = document.getElementById('tooltip-content');

            const probabilityItem = event.currentTarget;
            const borderColor = window.getComputedStyle(probabilityItem).borderColor;


            tooltip.style.borderColor = borderColor;
            tooltipTitle.style.color = borderColor;

            const variants = specificItemVariants[currentMode]?.[itemName]?.[currentArea];

            if (!variants || variants.length === 0) {
                tooltipContent.innerHTML = `<p>No specific variants available for ${itemName} in ${getAreaDisplayName(currentArea)}.</p>`;
            } else {
                let html = `<p style="margin-bottom: 10px; color: ${borderColor};">Available in ${getAreaDisplayName(currentArea)}:</p>`;
                html += '<ul class="variant-list">';

                variants.forEach(variant => {
                    const areaExclusive = variant.name.includes('[') ? variant.name.match(/\[(.*?)\]/)?.[1] : null;
                    const cleanName = variant.name.replace(/\s*\[.*?\]\s*/, '');

                    html += `
                <li class="variant-item" style="border-left: 4px solid ${borderColor};">
                    <div>
                        <div class="variant-name">${cleanName}</div>
                        ${areaExclusive ? `<div class="area-exclusive">Exclusive to ${areaExclusive}</div>` : ''}
                    </div>
                    <div class="variant-chance" style="color: ${borderColor};">${variant.chance}</div>
                </li>
            `;
                });

                html += '</ul>';
                tooltipContent.innerHTML = html;
            }

            tooltipTitle.textContent = `${itemName} Variants`;

            positionTooltip(tooltip, event);

            tooltip.style.display = 'block';
        }

        function positionTooltip(tooltip, event) {
            tooltip.style.display = 'block';
            const tooltipRect = tooltip.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            const clickX = event.clientX;
            const clickY = event.clientY;

            let top = clickY + 10;
            let left = clickX;

            if (left + tooltipRect.width > viewportWidth - 10) {
                left = viewportWidth - tooltipRect.width - 10;
            }

            if (left < 10) {
                left = 10;
            }

            if (top + tooltipRect.height > viewportHeight - 10) {
                top = clickY - tooltipRect.height - 10;

                if (top < 10) {
                    top = viewportHeight - tooltipRect.height - 10;
                }
            }

            if (top < 10) {
                top = 10;
            }

            tooltip.style.position = 'fixed';
            tooltip.style.top = `${top}px`;
            tooltip.style.left = `${left}px`;
            tooltip.style.transform = 'none';
        }

        function updateAreaToggle() {
            const areaToggle = document.getElementById('area-toggle-btn');
            const areaLabel = document.getElementById('area-label');
            const areaDropdown = document.getElementById('area-dropdown');

            function applyAreaClasses() {
                const areaNames = {
                    'frostspire': 'Frostspire Expanse',
                    'kingdom': 'Forgotten Kingdom',
                    'stonewake': 'Stonewake\'s Cross'
                };
                areaLabel.textContent = areaNames[currentArea];

                areaToggle.classList.remove('frostspire-active', 'kingdom-active', 'stonewake-active');
                areaToggle.classList.add(`${currentArea}-active`);

                document.querySelectorAll('#area-dropdown .area-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.area === currentArea) {
                        option.classList.add('active');
                    }
                });
            }

            applyAreaClasses();

            areaToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                areaDropdown.classList.toggle('show');
            });

            document.querySelectorAll('#area-dropdown .area-option').forEach(option => {
                option.addEventListener('click', () => {
                    const newArea = option.dataset.area;
                    if (newArea !== currentArea) {
                        currentArea = newArea;
                        applyAreaClasses();

                        areaDropdown.classList.remove('show');
                        selectedPreviewVariant = { baseItemType: null, variantName: null };

                        updateProbabilities();
                        updateItemPreview();

                        if (isQuickCraft) {
                            isQuickCraft = false;
                            quickCraftTargetItem = null;
                        }
                    }
                });
            });

            document.addEventListener('click', (e) => {
                if (!areaDropdown.contains(e.target) && !areaToggle.contains(e.target)) {
                    areaDropdown.classList.remove('show');
                }
            });
        }

        function renderOreInventory() {
            oreInventory.innerHTML = '';

            let filteredOres = oreData;

            if (activeFilter !== 'all') {
                if (activeFilter === 'has-trait') {
                    filteredOres = oreData.filter(ore => ore.traits.some(trait => trait.type === 'weapon' || trait.type === 'all' || trait.type === 'armor'));
                }
                else if (activeFilter === 'has-weapon-trait') {
                    filteredOres = oreData.filter(ore => ore.traits.some(trait => trait.type === 'weapon' || trait.type === 'all'));
                }
                else if (activeFilter === 'has-armor-trait') {
                    filteredOres = oreData.filter(ore => ore.traits.some(trait => trait.type === 'armor' || trait.type === 'all'));
                }
                else {
                    filteredOres = oreData.filter(ore => ore.area === activeFilter);
                }
            }

            if (currentSearchTerm.trim() !== '') {
                const searchTerm = currentSearchTerm.toLowerCase().trim();
                filteredOres = filteredOres.filter(ore =>
                    ore.name.toLowerCase().includes(searchTerm) ||
                    ore.area.toLowerCase().includes(searchTerm) ||
                    ore.rarity.toLowerCase().includes(searchTerm)
                );
            }

            if (filteredOres.length === 0) {
                oreInventory.innerHTML = `
            <div class="search-empty-state">
                <i class="fas fa-search"></i>
                <p>No ores found matching "${currentSearchTerm}"</p>
                <button id="clear-search-from-empty" 
                        style="
                            margin-top: 10px;
                            padding: 8px 20px;
                            background: var(--primary-light);
                            border: 1px solid var(--primary);
                            border-radius: 20px;
                            color: var(--text);
                            font-size: 0.85rem;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        ">
                    Clear Search
                </button>
            </div>
        `;

                return;
            }

            filteredOres.forEach(ore => {
                const oreElement = document.createElement('div');
                oreElement.className = `ore-item ${ore.rarity} ${ore.traits.length > 0 ? 'has-trait' : ''}`;
                oreElement.dataset.id = ore.id;

                if (oreImages[ore.name]) {
                    oreElement.style.backgroundImage = `url('${oreImages[ore.name]}')`;
                } else {
                    oreElement.classList.add('no-image');
                    oreElement.innerHTML = `<i class="fas fa-gem" style="color: ${ore.color}; font-size: 40px; margin-bottom: 10px;"></i>`;
                }

                oreElement.innerHTML = `
    ${ore.traits.length > 0 ? '<div class="trait-indicator"><i class="fas fa-magic"></i></div>' : ''}
    ${!oreImages[ore.name] ? `<div class="ore-icon"><i class="fas fa-gem" style="color: ${ore.color};"></i></div>` : ''}
    <div class="ore-name"><span style="color: ${ore.color};">${ore.name}</span></div>
    <div class="ore-multiplier">${ore.multiplier}x</div>
`;

                oreElement.addEventListener('click', () => addOreToMix(ore.id));
                oreInventory.appendChild(oreElement);
            });


        }

        function addOreToMix(oreId) {
            const uniqueOres = oreMix.map(item => item.id);
            const oreIndex = uniqueOres.indexOf(oreId);

            if (oreIndex === -1 && uniqueOres.length >= 4) {
                return;
            }

            if (oreIndex === -1) {
                oreMix.push({ id: oreId, count: 1 });
            } else {
                oreMix[oreIndex].count++;
            }

            updateOreSlots();
            updateProbabilities();
        }

        function removeOreFromMix(oreId) {
            const oreIndex = oreMix.findIndex(item => item.id === oreId);

            if (oreIndex !== -1) {
                if (oreMix[oreIndex].count > 1) {
                    oreMix[oreIndex].count--;
                } else {
                    oreMix.splice(oreIndex, 1);
                }
            }

            updateOreSlots();
            updateProbabilities();
        }

        function updateOreSlots() {
            const slots = document.querySelectorAll('.slot');
            let totalOres = 0;
            let uniqueOres = oreMix.length;
            const oreInventoryContainer = document.getElementById('ore-inventory');
            const oreItems = oreInventoryContainer.querySelectorAll('.ore-item');

            oreItems.forEach(item => {
                item.classList.remove('in-forge');
            });

            oreMix.forEach(item => {
                const oreElement = document.querySelector(`.ore-item[data-id="${item.id}"]`);
                if (oreElement) {
                    oreElement.classList.add('in-forge');
                }
            });

            if (oreMix.length >= 4) {
                oreInventoryContainer.parentElement.classList.add('ore-inventory-max');
            } else {
                oreInventoryContainer.parentElement.classList.remove('ore-inventory-max');
            }

            let multiplierSum = 0;
            oreMix.forEach(item => {
                const ore = oreData.find(o => o.id === item.id);
                totalOres += item.count;
                multiplierSum += ore.multiplier * item.count;
            });

            const multiplier = totalOres > 0 ? (multiplierSum / totalOres).toFixed(2) : 0;

            slots.forEach(slot => {
                slot.innerHTML = '<div class="slot-placeholder">Empty slot</div>';
                slot.classList.remove('filled');
            });

            oreMix.forEach((item, index) => {
                if (index >= 4) return;

                const ore = oreData.find(o => o.id === item.id);
                const slot = slots[index];
                const percentage = totalOres > 0 ? ((item.count / totalOres) * 100).toFixed(1) : 0;

                let backgroundStyle = '';
                if (oreImages[ore.name]) {
                    backgroundStyle = `style="background-image: url('${oreImages[ore.name]}')"`;
                }

                slot.innerHTML = `
    <div class="slot-ore" ${backgroundStyle} data-id="${ore.id}">
        ${!oreImages[ore.name] ? `<i class="fas fa-gem" style="color: ${ore.color}; font-size: 30px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"></i>` : ''}
        <div class="slot-ore-name">
            <span style="color: ${ore.color}; font-weight: bold;">${ore.name}</span>
        </div>
        <div class="slot-ore-count">${item.count}</div>
        <div class="slot-ore-percentage">${percentage}%</div>
    </div>
`;
                slot.classList.add('filled');

                slot.querySelector('.slot-ore').addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeOreFromMix(ore.id);
                });
            });

            updateActiveTraits(totalOres);
            updateItemPreview();
        }

        function updateActiveTraits(totalOres) {
            activeTraitsContainer.innerHTML = '';

            if (oreMix.length === 0) {
                activeTraitsContainer.innerHTML = '<div class="trait-placeholder">Add ores with traits to see effects (10% at least)...</div>';
                return;
            }

            const traitsList = [];

            oreMix.forEach(item => {
                const ore = oreData.find(o => o.id === item.id);
                const percentage = (item.count / totalOres) * 100;

                if (ore.traits && ore.traits.length > 0 && percentage >= 10) {
                    ore.traits.forEach(trait => {
                        const isApplicable = trait.type === 'all' || trait.type === currentMode;

                        if (isApplicable) {
                            let scaledValues = {};
                            Object.keys(trait.scaling).forEach(key => {
                                const scale = trait.scaling[key];
                                let value = 0;

                                if (percentage >= 30) {
                                    value = scale.max;
                                } else if (percentage >= 10) {
                                    const scaleFactor = (percentage - 10) / 20;
                                    value = scale.min + (scale.max - scale.min) * scaleFactor;
                                }

                                scaledValues[key] = Math.round(value * 10) / 10;
                            });

                            let formattedDesc = trait.description;
                            Object.keys(scaledValues).forEach(key => {
                                formattedDesc = formattedDesc.replace(
                                    new RegExp(`([-+]?){${key}}(\\s*[+%s]*)`, 'g'),
                                    `<span class="scalable-value">$1${scaledValues[key]}<span class="scalable-symbol">$2</span></span>`
                                );
                            });

                            traitsList.push({
                                oreName: ore.name,
                                description: formattedDesc,
                                percentage: percentage,
                                oreId: ore.id,
                                rawDescription: trait.description
                            });
                        }
                    });
                }
            });

            if (traitsList.length === 0) {
                activeTraitsContainer.innerHTML = '<div class="trait-placeholder">No active traits (need at least 10% of an ore with traits)</div>';
                return;
            }

            traitsList.forEach(traitInfo => {
                const traitElement = document.createElement('div');
                traitElement.className = 'trait-card';
                traitElement.dataset.oreId = traitInfo.oreId;
                traitElement.dataset.percentage = traitInfo.percentage.toFixed(1);

                const ore = oreData.find(o => o.id === traitInfo.oreId);
                const oreColor = ore ? ore.color : 'var(--primary)';
                const iconClass = getTraitIconClass(traitInfo.oreId);

                traitElement.innerHTML = `
        <div class="trait-content">
            <div class="trait-name">
                
                    
                    <span style="color: ${oreColor}; font-weight: bold; text-shadow: 0 0 4px rgba(0, 0, 0, 0.6);"><i class="fas ${iconClass}" style="color: ${oreColor}; font-size: 0.9rem;"></i> ${traitInfo.oreName}</span>
                    <span class="trait-percentage">${traitInfo.percentage.toFixed(1)}%</span>
               
            </div>
            <div class="trait-description">${traitInfo.description}</div>
        </div>
    `;

                activeTraitsContainer.appendChild(traitElement);
            });
        }

        function updateProbabilities() {
            probabilityList.innerHTML = '';

            const totalOres = oreMix.reduce((sum, item) => sum + item.count, 0);

            let probabilities;
            if (currentMode === 'weapon') {
                probabilities = currentArea === 'frostspire' ? weaponProbabilitiesFrostspire : weaponProbabilities;
            } else {
                probabilities = armorProbabilities;
            }

            const optimal = currentMode === 'weapon' ? optimalCounts.weapon : optimalCounts.armor;

            let closestCount = 3;
            if (totalOres >= 50) {
                closestCount = 50;
            } else if (totalOres >= 3) {
                const counts = Object.keys(probabilities).map(Number);
                closestCount = counts.reduce((prev, curr) => {
                    return (Math.abs(curr - totalOres) < Math.abs(prev - totalOres) ? curr : prev);
                });
            }

            const currentProbs = probabilities[closestCount] || {};

            Object.entries(currentProbs).forEach(([itemName, probability]) => {
                const probabilityPercent = (probability * 100).toFixed(1);

                let typeClass = '';
                if (currentMode === 'weapon') {
                    if (itemName === 'Dagger') typeClass = 'weapon-dagger';
                    else if (itemName === 'Straight Sword') typeClass = 'weapon-straight-sword';
                    else if (itemName === 'Gauntlet') typeClass = 'weapon-gauntlet';
                    else if (itemName === 'Katana') typeClass = 'weapon-katana';
                    else if (itemName === 'Great Sword') typeClass = 'weapon-great-sword';
                    else if (itemName === 'Great Axe') typeClass = 'weapon-great-axe';
                    else if (itemName === 'Colossal Sword') typeClass = 'weapon-colossal-sword';
                    else if (itemName === 'Mace') typeClass = 'weapon-gauntlet';
                    else if (itemName === 'Axe') typeClass = 'weapon-katana';
                    else if (itemName === 'Spear') typeClass = 'weapon-great-sword';
                } else {
                    if (itemName.includes('Light')) typeClass = 'armor-light';
                    else if (itemName.includes('Medium')) typeClass = 'armor-medium';
                    else if (itemName.includes('Heavy')) typeClass = 'armor-heavy';
                }

                const itemElement = document.createElement('div');
                itemElement.className = `probability-item ${typeClass}`;
                itemElement.dataset.itemName = itemName;

                itemElement.innerHTML = `
            <div class="item-header">
                <div class="item-name">${itemName}</div>
                <div class="probability-value">${probabilityPercent}%</div>
            </div>
            <div class="probability-bar">
                <div class="probability-fill" style="width: ${probabilityPercent}%"></div>
            </div>
        `;

                itemElement.addEventListener('click', (e) => {
                    showVariantTooltip(itemName, e, typeClass);
                    e.stopPropagation();
                });

                itemElement.addEventListener('mouseenter', () => {
                    itemElement.style.cursor = 'pointer';
                });

                probabilityList.appendChild(itemElement);
            });

            if (totalOres < 3) {
                probabilityList.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-secondary);">
                <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Add at least 3 ores to see forge chances</p>
            </div>
        `;
            }
        }

        function setupQuickCraft() {
            quickCraftBtn.addEventListener('click', () => {
                quickCraftModal.style.display = 'flex';
                setTimeout(() => quickCraftModal.classList.add('show'), 10);

                if (window.innerWidth <= 480) {
                    document.body.classList.add('modal-open');
                }

                resetQuickCraft();
                showStep(0);
                updateProgressBar(0);
                setTimeout(() => quickCraftModal.focus(), 10);
            });

            modalClose.addEventListener('click', () => {
                resetQuickCraft();
                quickCraftModal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    quickCraftModal.style.display = 'none';
                    quickCraftModal.classList.remove('show');
                    quickCraftModal.style.animation = '';
                    document.body.classList.remove('modal-open');
                }, 300);
                resetQuickCraft();
            });

            quickCraftModal.addEventListener('click', (e) => {
                if (e.target === quickCraftModal) {
                    resetQuickCraft();
                    quickCraftModal.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        quickCraftModal.style.display = 'none';
                        quickCraftModal.classList.remove('show');
                        quickCraftModal.style.animation = '';
                        document.body.classList.remove('modal-open');
                    }, 300);
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && quickCraftModal.style.display === 'flex') {
                    resetQuickCraft();
                    quickCraftModal.style.display = 'none';
                    document.body.classList.remove('modal-open');
                }
            });

            if (window.innerWidth <= 480) {
                quickCraftModal.addEventListener('wheel', (e) => {
                    const modalContent = document.querySelector('.modal-content');
                    const atTop = modalContent.scrollTop === 0;
                    const atBottom = modalContent.scrollHeight - modalContent.scrollTop === modalContent.clientHeight;

                    if ((e.deltaY < 0 && atTop) || (e.deltaY > 0 && atBottom)) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                }, { passive: false });
            }

            quickCraftModal.addEventListener('touchmove', (e) => {
                if (e.target === quickCraftModal || e.target.closest('.modal-content')) {
                    return;
                }
                e.preventDefault();
            }, { passive: false });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 0) {
                    showStep(currentStep - 1);
                }
            });

            nextBtn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    if (currentStep < 3) {
                        showStep(currentStep + 1);
                    }
                }
            });

            craftBtn.addEventListener('click', () => {
                applyQuickCraft();

                quickCraftModal.style.animation = 'fadeOut .3s ease';
                setTimeout(() => {
                    quickCraftModal.style.display = 'none';
                    quickCraftModal.classList.remove('show');
                    quickCraftModal.style.animation = '';
                    document.body.classList.remove('modal-open');
                }, 300);
                resetSteps();
            });

            document.querySelectorAll('.modal-option[data-type]').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.modal-option[data-type]').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    quickCraftType = option.dataset.type;
                });
            });
        }

        function resetSteps() {
            [stepType, stepItem, stepTraits, stepSummary].forEach(s => {
                s.classList.remove('active', 'step-anim-in', 'step-anim-out');
            });
        }

        function updateProgressBar(step) {
            for (let i = 0; i < 4; i++) {
                const stepElement = document.getElementById(`step-progress-${i}`);
                if (stepElement) {
                    stepElement.classList.remove('active', 'completed');

                    if (i < step) {
                        stepElement.classList.add('completed');
                    } else if (i === step) {
                        stepElement.classList.add('active');
                    }
                }
            }

            const progressLine = document.getElementById('progress-line');
            if (progressLine) {
                const progressPercent = Math.min(step * 33.33, 100);
                progressLine.style.setProperty('--progress-percent', `${progressPercent}%`);

                if (step > 0) {
                    progressLine.style.boxShadow = `0 0 15px var(--primary-glow)`;
                }
            }
        }

        function showStep(step) {
            const steps = [stepType, stepItem, stepTraits, stepSummary];

            const previous = steps[currentStep];
            const next = steps[step];

            if (previous && previous !== next) {
                previous.classList.remove('active');
                previous.classList.add('step-anim-out');

                setTimeout(() => {
                    previous.classList.remove('step-anim-out');
                }, 300);
            }

            next.classList.add('active', 'step-anim-in');
            setTimeout(() => next.classList.remove('step-anim-in'), 300);

            currentStep = step;

            updateProgressBar(step);

            prevBtn.style.display = step === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = step < 3 ? 'inline-block' : 'none';
            craftBtn.style.display = step === 3 ? 'inline-block' : 'none';

            switch (step) {
                case 1: loadItemOptions(); break;
                case 2: loadTraitOptions(); break;
                case 3: loadSummary(); break;
            }
        }

        function validateStep(step) {
            switch (step) {
                case 0:
                    if (!quickCraftType) {
                        return false;
                    }
                    return true;
                case 1:
                    if (!quickCraftItem) {
                        return false;
                    }
                    return true;
                case 2:
                    if (selectedTraits.length === 0) {

                        return false;

                    }
                    return true;
                default:
                    return true;
            }
        }

        function loadItemOptions() {
            itemOptions.innerHTML = '';
            let items;
            if (quickCraftType === 'weapon') {
                items = currentArea === 'frostspire' ? optimalCountsFrostspire.weapon : optimalCounts.weapon;
            } else {
                items = optimalCounts.armor;
            }
            if (quickCraftType !== currentMode) {
                currentMode = quickCraftType;
                if (currentMode === 'weapon') {
                    weaponToggle.classList.add('active');
                    armorToggle.classList.remove('active');
                    applyColorScheme(weaponColors);
                } else {
                    armorToggle.classList.add('active');
                    weaponToggle.classList.remove('active');
                    applyColorScheme(armorColors);
                }
                updateProbabilities();
            }

            Object.entries(items).forEach(([itemName, optimalCount]) => {
                const option = document.createElement('div');
                option.className = 'modal-option';
                option.dataset.item = itemName;
                option.innerHTML = `
                    <div style="font-weight: bold; font-size: 0.9rem;">${itemName}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Optimal: ${optimalCount} ores</div>
                `;

                option.addEventListener('click', () => {
                    document.querySelectorAll('.modal-option[data-item]').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    quickCraftItem = {
                        name: itemName,
                        optimal: optimalCount
                    };
                });

                itemOptions.appendChild(option);
            });
        }

        function loadTraitOptions() {
            traitOptions.innerHTML = '';
            selectedTraits = [];

            const availableTraits = oreData.filter(ore =>
                ore.traits.length > 0 &&
                ore.traits.some(trait => trait.type === 'all' || trait.type === quickCraftType)
            );

            const updateDisabledState = () => {
                const allOptions = document.querySelectorAll('.trait-option');
                const isMaxSelected = selectedTraits.length >= 4;

                allOptions.forEach(option => {
                    const oreId = parseInt(option.dataset.oreId);
                    const isSelected = selectedTraits.some(trait => trait.oreId === oreId);

                    if (isMaxSelected && !isSelected) {
                        option.classList.add('disabled');
                    } else {
                        option.classList.remove('disabled');
                    }
                });
            };

            availableTraits.forEach(ore => {
                ore.traits.forEach(trait => {
                    if (trait.type === 'all' || trait.type === quickCraftType) {
                        const option = document.createElement('div');
                        option.className = 'trait-option';
                        option.dataset.oreId = ore.id;

                        let desc = trait.description;
                        Object.keys(trait.scaling).forEach(key => {
                            const scale = trait.scaling[key];
                            desc = desc.replace(
                                new RegExp(`([-+]?){${key}}(\\s*[+%s]*)`, 'g'),
                                `<span class="scalable-value">$1${scale.min}-${scale.max}<span class="scalable-symbol">$2</span></span>`
                            );
                        });

                        option.innerHTML = `
    <div class="trait-info">
        <div class="trait-name">
            <div style="display: flex; align-items: center; gap: 6px;">
                <i class="fas ${getTraitIconClass(option.dataset.oreId)}" style="color: ${ore.color}; font-size: 1rem;"></i>
                <span style="color: ${ore.color}; font-weight: bold; font-size: 0.95rem;">${ore.name}</span>
                <span style="font-size: 0.85rem; color: var(--text-secondary);">(${ore.multiplier}x)</span>
            </div>
        </div>
        <div class="trait-desc">${desc}</div>
    </div>
`;

                        option.addEventListener('click', () => {
                            const isSelected = option.classList.contains('selected');
                            const isMaxSelected = selectedTraits.length >= 4;

                            if (isMaxSelected && !isSelected) {
                                return;
                            }

                            if (!isSelected) {
                                selectedTraits.push({
                                    oreId: ore.id,
                                    oreName: ore.name,
                                    description: trait.description,
                                    scaling: trait.scaling
                                });
                                option.classList.add('selected');
                            } else {
                                selectedTraits = selectedTraits.filter(t => t.oreId !== ore.id);
                                option.classList.remove('selected');
                            }
                            updateDisabledState();
                        });

                        traitOptions.appendChild(option);
                    }
                });
            });
            updateDisabledState();
        }

        function loadSummary() {
            const optimalCount = quickCraftItem.optimal;
            let mixPlan = [];

            if (selectedTraits.length === 0) {
                mixPlan = [{ id: 1, count: optimalCount }];
            } else {

                const traitCount = selectedTraits.length;
                selectedTraits.forEach(trait => {
                    mixPlan.push({
                        id: trait.oreId,
                        count: 1
                    });
                });

                let totalOres = traitCount;
                const remainingOres = optimalCount - traitCount;

                if (remainingOres > 0) {
                    const baseAddition = Math.floor(remainingOres / traitCount);
                    const extraOres = remainingOres % traitCount;

                    mixPlan.forEach((item, index) => {
                        item.count += baseAddition;
                    });

                    for (let i = 0; i < extraOres; i++) {
                        mixPlan[i].count++;
                    }
                }

                totalOres = mixPlan.reduce((sum, item) => sum + item.count, 0);

                if (totalOres < optimalCount) {
                    const shortfall = optimalCount - totalOres;

                    for (let i = 0; i < shortfall; i++) {
                        const traitIndex = i % traitCount;
                        mixPlan[traitIndex].count++;
                    }
                }

                totalOres = mixPlan.reduce((sum, item) => sum + item.count, 0);
                if (totalOres > optimalCount) {
                    const excess = totalOres - optimalCount;
                    mixPlan[mixPlan.length - 1].count -= excess;
                }
            }

            let summaryHTML = `
                <div class="forge-result-container" style="margin-bottom: 20px; background: var(--primary-light);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <i class="fas fa-hammer" style="font-size: 1.5rem; color: var(--primary);"></i>
                        <div>
                            <div style="font-weight: bold; font-size: 1.2rem;">${quickCraftItem.name}</div>
                            <div style="color: var(--text-secondary);">${quickCraftType === 'weapon' ? 'Weapon' : 'Armor'}  Optimal: ${optimalCount} ores</div>
                        </div>
                    </div>
            `;

            if (selectedTraits.length > 0) {
                summaryHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: bold; margin-bottom: 10px;">Selected Traits:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                `;

                selectedTraits.forEach(trait => {
                    const ore = oreData.find(o => o.id === trait.oreId);
                    const oreColor = ore ? ore.color : 'var(--primary)';
                    const traitIconClass = getTraitIconClass(trait.oreId);

                    summaryHTML += `
    <div style="background: ${oreColor}15; border: 1px solid ${oreColor}; border-radius: var(--border-radius); padding: 5px 12px; font-size: 0.85rem; display: flex; align-items: center; gap: 6px;">
        <i class="fas ${traitIconClass}" style="color: ${oreColor}; font-size: 0.85rem;"></i>
        <span style="color: ${oreColor}; font-weight: bold;">${trait.oreName}</span>
    </div>
`;
                });

                summaryHTML += `</div></div>`;
            }

            summaryHTML += `
                    <div>
                        <div style="font-weight: bold; margin-bottom: 10px;">Ore Mix:</div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
            `;

            const totalOresInMix = mixPlan.reduce((sum, item) => sum + item.count, 0);
            const multiplierSum = mixPlan.reduce((sum, item) => {
                const ore = oreData.find(o => o.id === item.id);
                return sum + (ore.multiplier * item.count);
            }, 0);
            const avgMultiplier = (multiplierSum / totalOresInMix).toFixed(2);

            mixPlan.forEach(item => {
                const ore = oreData.find(o => o.id === item.id);
                const percentage = ((item.count / totalOresInMix) * 100).toFixed(1);
                summaryHTML += `
    <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 10px; border-radius: var(--border-radius); border-left: 4px solid ${ore.color};">
        <div>
            <div style="font-weight: bold; display: flex; align-items: center; gap: 6px;">
                <i class="fas fa-gem" style="color: ${ore.color}; font-size: 0.9rem;"></i>
                <span style="color: ${ore.color};">${ore.name}</span>
            </div>
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 2px;">
                ${ore.multiplier}x multiplier  ${ore.rarity.charAt(0).toUpperCase() + ore.rarity.slice(1)}
            </div>
        </div>
        <div style="text-align: right;">
            <div style="font-weight: bold; color: var(--text);">${item.count}x</div>
            <div style="font-size: 0.85rem; color: var(--text-secondary);">${percentage}%</div>
        </div>
    </div>
`;
            });

            summaryHTML += `
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background: var(--primary-light); border-radius: var(--border-radius); text-align: center;">
                            <i class="fas fa-calculator"></i> Total: ${totalOresInMix} ores  Avg Multiplier: ${avgMultiplier}x
                        </div>
                    </div>
                </div>
            `;

            summaryContent.innerHTML = summaryHTML;

            summaryContent.dataset.mixPlan = JSON.stringify(mixPlan);
        }

        function applyQuickCraft() {
            const mixPlan = JSON.parse(summaryContent.dataset.mixPlan);

            isQuickCraft = true;
            quickCraftTargetItem = quickCraftItem.name;

            if (quickCraftType !== currentMode) {
                currentMode = quickCraftType;
                if (currentMode === 'weapon') {
                    weaponToggle.classList.add('active');
                    armorToggle.classList.remove('active');
                    applyColorScheme(weaponColors);
                } else {
                    armorToggle.classList.add('active');
                    weaponToggle.classList.remove('active');
                    applyColorScheme(armorColors);
                }
                resetPreviewSelection();
                updateProbabilities();
            }

            oreMix = [];
            mixPlan.forEach(item => {
                const existingIndex = oreMix.findIndex(ore => ore.id === item.id);
                if (existingIndex !== -1) {
                    oreMix[existingIndex].count += item.count;
                } else {
                    oreMix.push({ id: item.id, count: item.count });
                }
            });

            updateOreSlots();
            if (quickCraftType === currentMode) {
                updateProbabilities();
            }

            quickCraftModal.style.display = 'none';
            document.body.classList.remove('modal-open');
        }

        function resetQuickCraft() {
            quickCraftType = null;
            quickCraftItem = null;
            selectedTraits = [];
            currentStep = 0;

            updateProgressBar(0);

            document.querySelectorAll('.modal-option').forEach(o => {
                o.classList.remove('selected', 'disabled');
            });
            document.querySelectorAll('.trait-option').forEach(o => {
                o.classList.remove('selected', 'disabled');
            });

            [stepType, stepItem, stepTraits, stepSummary].forEach(step => {
                step.classList.remove('active', 'step-anim-in', 'step-anim-out');
            });

            stepType.classList.add('active');
        }

        function getVariantProbabilities(variants) {
            if (!variants || variants.length === 0) {
                return null;
            }

            const weights = variants.map(v => {
                const [num, den] = v.chance.split('/').map(Number);
                return num / den;
            });

            const total = weights.reduce((a, b) => a + b, 0);
            return variants.map((v, i) => ({
                ...v,
                normalizedProb: weights[i] / total
            }));
        }

        function getRandomVariant(itemType) {
            const variants = specificItemVariants[currentMode]?.[itemType]?.[currentArea];
            if (!variants || variants.length === 0) {
                if (currentArea === 'frostspire') {
                    let baseVariants;
                    if (itemType === 'Mace') {
                        baseVariants = specificItemVariants[currentMode]?.['Gauntlet']?.[currentArea];
                    } else if (itemType === 'Axe') {
                        baseVariants = specificItemVariants[currentMode]?.['Katana']?.[currentArea];
                    } else if (itemType === 'Spear') {
                        baseVariants = specificItemVariants[currentMode]?.['Great Sword']?.[currentArea];
                    }

                    if (baseVariants && baseVariants.length > 0) {
                        const weightedVariants = getVariantProbabilities(baseVariants);
                        if (weightedVariants) {
                            let random = Math.random();
                            let cumulative = 0;

                            for (const variant of weightedVariants) {
                                cumulative += variant.normalizedProb;
                                if (random <= cumulative) {
                                    return variant;
                                }
                            }

                            return weightedVariants[0];
                        }
                    }
                }

                return { name: itemType, chance: "1/1", probability: 1.0 };
            }

            const weightedVariants = getVariantProbabilities(variants);
            if (!weightedVariants) return { name: itemType, chance: "1/1", probability: 1.0 };

            let random = Math.random();
            let cumulative = 0;

            for (const variant of weightedVariants) {
                cumulative += variant.normalizedProb;
                if (random <= cumulative) {
                    return variant;
                }
            }

            return weightedVariants[0];
        }

        function getMainOre() {
            if (oreMix.length === 0) return null;

            let maxCount = 0;
            let mainOre = null;

            oreMix.forEach(item => {
                if (item.count > maxCount) {
                    maxCount = item.count;
                    const ore = oreData.find(o => o.id === item.id);
                    mainOre = ore;
                }
            });

            const ties = oreMix.filter(item => item.count === maxCount);
            if (ties.length > 1) {
                ties.sort((a, b) => {
                    const oreA = oreData.find(o => o.id === a.id);
                    const oreB = oreData.find(o => o.id === b.id);
                    return oreB.multiplier - oreA.multiplier;
                });
                mainOre = oreData.find(o => o.id === ties[0].id);
            }

            return mainOre;
        }

        function calculateScaledStats(itemName, multiplier) {
            const stats = baseItemStats[currentMode][itemName];
            if (!stats) return null;

            const scaled = { ...stats };

            if (currentMode === 'weapon') {
                scaled.damage = stats.damage * multiplier;
                scaled.price = stats.price * multiplier;
            } else {
                scaled.def = stats.def * multiplier;
                scaled.price = stats.price * multiplier;
            }

            return scaled;
        }

        function getActiveTraits() {
            const totalOres = oreMix.reduce((sum, item) => sum + item.count, 0);
            const traitsList = [];

            oreMix.forEach(item => {
                const ore = oreData.find(o => o.id === item.id);
                const percentage = (item.count / totalOres) * 100;

                if (ore.traits && ore.traits.length > 0 && percentage >= 10) {
                    ore.traits.forEach(trait => {
                        const isApplicable = trait.type === 'all' || trait.type === currentMode;

                        if (isApplicable) {
                            let scaledValues = {};
                            Object.keys(trait.scaling).forEach(key => {
                                const scale = trait.scaling[key];
                                let value = 0;

                                if (percentage >= 30) {
                                    value = scale.max;
                                } else if (percentage >= 10) {
                                    const scaleFactor = (percentage - 10) / 20;
                                    value = scale.min + (scale.max - scale.min) * scaleFactor;
                                }

                                scaledValues[key] = Math.round(value * 10) / 10;
                            });

                            let formattedDesc = trait.description;
                            Object.keys(scaledValues).forEach(key => {
                                formattedDesc = formattedDesc.replace(`{${key}}`, scaledValues[key]);
                            });

                            traitsList.push({
                                oreName: ore.name,
                                description: formattedDesc,
                                percentage: percentage,
                                oreColor: ore.color,
                                oreId: ore.id,
                            });
                        }
                    });
                }
            });

            return traitsList;
        }

        function simulateForge() {
            const totalOres = oreMix.reduce((sum, item) => sum + item.count, 0);

            if (totalOres < 3) {
                return;
            }

            const forgeBtn = document.getElementById('forge-btn');
            const originalText = forgeBtn.innerHTML;
            forgeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Forging...';
            forgeBtn.disabled = true;

            let multiplierSum = 0;
            oreMix.forEach(item => {
                const ore = oreData.find(o => o.id === item.id);
                multiplierSum += ore.multiplier * item.count;
            });
            const multiplier = multiplierSum / totalOres;

            let selectedItemType;

            if (isQuickCraft && quickCraftTargetItem) {
                selectedItemType = quickCraftTargetItem;
            } else {
                let probabilities;
                if (currentMode === 'weapon') {
                    probabilities = currentArea === 'frostspire' ? weaponProbabilitiesFrostspire : weaponProbabilities;
                } else {
                    probabilities = armorProbabilities;
                }

                const counts = Object.keys(probabilities).map(Number);
                const closestCount = counts.reduce((prev, curr) => {
                    return (Math.abs(curr - totalOres) < Math.abs(prev - totalOres) ? curr : prev);
                });

                const currentProbs = probabilities[closestCount] || {};

                let random = Math.random();
                selectedItemType = null;
                let cumulativeProb = 0;

                for (const [itemType, prob] of Object.entries(currentProbs)) {
                    cumulativeProb += prob;
                    if (random <= cumulativeProb) {
                        selectedItemType = itemType;
                        break;
                    }
                }

                if (!selectedItemType) {
                    selectedItemType = Object.keys(currentProbs)[0];
                }
            }

            const variant = getRandomVariant(selectedItemType);
            const itemName = variant.name.replace(/\s*\[.*?\]\s*/g, '');
            const mainOre = getMainOre();
            const scaledStats = calculateScaledStats(itemName, multiplier);
            const activeTraits = getActiveTraits();

            setTimeout(() => {
                showForgeResult({
                    itemName: itemName,
                    itemType: selectedItemType,
                    variant: variant,
                    multiplier: multiplier,
                    mainOre: mainOre,
                    stats: scaledStats,
                    traits: activeTraits,
                    area: currentArea,
                    totalOres: totalOres
                });

                saveForgedItem({
                    itemName: itemName,
                    itemType: selectedItemType,
                    variant: variant,
                    multiplier: multiplier,
                    mainOre: mainOre,
                    stats: scaledStats,
                    traits: activeTraits,
                    area: currentArea,
                    totalOres: totalOres,
                    mode: currentMode
                });

                forgeBtn.innerHTML = originalText;
                forgeBtn.disabled = false;
            }, 300);
        }


        function showForgeResult(result) {
            const modal = document.getElementById('forge-result-modal');
            const content = document.getElementById('forge-result-body');

            const bgColor = result.mainOre ? result.mainOre.color : '#FF6600';
            let areaBgColor, areaColor, areaIcon, areaName;

            switch (currentArea) {
                case 'kingdom':
                    areaBgColor = 'var(--primary-light)';
                    areaColor = 'var(--primary)';
                    areaIcon = 'fas fa-crown';
                    areaName = 'Forgotten Kingdom';
                    break;
                case 'stonewake':
                    areaBgColor = 'rgba(8,78,78,0.2)';
                    areaColor = 'var(--stonewake-teal)';
                    areaIcon = 'fas fa-mountain';
                    areaName = 'Stonewake\'s Cross';
                    break;
                case 'frostspire':
                    areaBgColor = 'rgba(106,183,255,0.2)';
                    areaColor = '#6ab7ff';
                    areaIcon = 'fas fa-snowflake';
                    areaName = 'Frostspire Expanse';
                    break;
                default:
                    areaBgColor = 'var(--primary-light)';
                    areaColor = 'var(--primary)';
                    areaIcon = 'fas fa-map-marker-alt';
                    areaName = 'Unknown Area';
            }

            const itemImage = itemImages[result.itemName] || '';

            content.innerHTML = `
        <div class="forge-result-container" style="background: linear-gradient(135deg, ${bgColor}15 0%, ${bgColor}08 25%, rgba(0,0,0,0.1) 50%, ${bgColor}08 75%, ${bgColor}15 100%); border: 2px solid ${bgColor}40;">
            <div class="forge-result-header">
                ${itemImage ? `
                    <div class="forge-result-image" style="background-image: url('${itemImage}'); border-color: ${bgColor};">
                    </div>
                ` : ''}
                <div class="forge-result-details">
                    <div class="forge-result-name" style="color: ${bgColor};">
                        ${result.itemName}
                    </div>
                    <div class="forge-result-type">
                        ${result.itemType}  ${result.mainOre?.rarity ? result.mainOre.rarity.charAt(0).toUpperCase() + result.mainOre.rarity.slice(1) : 'Common'}
                    </div>
                    <div class="forge-result-tags">
                        <div class="forge-tag" style="background: var(--primary-light); color: var(--text-secondary);">
                            <i class="fas fa-percent"></i> ${result.multiplier.toFixed(2)}x Multi
                        </div>
                        <div class="forge-tag" style="background: var(--primary-light); color: var(--text-secondary);">
                            <i class="fas fa-star"></i> [100]% Masterwork
                        </div>
                        <div class="forge-tag" style="background: ${bgColor}30; color: ${bgColor}; border-color: ${bgColor};">
                            <i class="fas fa-gem"></i> ${result.mainOre?.name || 'Stone'}
                        </div>
                        <div class="forge-tag" style="background: ${areaBgColor}; border-color: ${areaColor}; color: ${areaColor};">
                        <i class="${areaIcon}"></i> ${areaName}
                    </div>
                    </div>
                </div>
            </div>
            
            <div class="forge-stats-grid">
                ${currentMode === 'weapon' ? `
                    <div class="forge-stat-item">
                        <div class="forge-stat-value">${result.stats.damage.toFixed(2)}</div>
                        <div class="forge-stat-label">DAMAGE</div>
                    </div>
                    <div class="forge-stat-item">
                        <div class="forge-stat-value">${result.stats.atkSpeed}s</div>
                        <div class="forge-stat-label">ATK SPEED</div>
                    </div>
                    <div class="forge-stat-item">
                        <div class="forge-stat-value">${result.stats.range} studs</div>
                        <div class="forge-stat-label">RANGE</div>
                    </div>
                    <div class="forge-stat-item">
                        <div class="forge-stat-value">$${Math.round(result.stats.price)}</div>
                        <div class="forge-stat-label">VALUE</div>
                    </div>
                ` : `
                    <div class="forge-stat-item">
                        <div class="forge-stat-value">+${result.stats.health}%</div>
                        <div class="forge-stat-label">HEALTH BONUS</div>
                    </div>
                    <div class="forge-stat-item">
                        <div class="forge-stat-value">${Math.round(result.stats.def)}</div>
                        <div class="forge-stat-label">DEF</div>
                    </div>
                    <div class="forge-stat-item" style="grid-column: 1 / -1;">
                        <div class="forge-stat-value">$${Math.round(result.stats.price)}</div>
                        <div class="forge-stat-label">VALUE</div>
                    </div>
                `}
            </div>
            
            ${result.traits.length > 0 ? `
                <div class="traits-section">
                    <div class="section-title">
                        <span><i class="fas fa-magic"></i> Item Traits</span>
                    </div>
                    <div class="traits-list-container">
                        ${result.traits.map(trait => `
                            <div class="forge-trait-item" style="border-color: ${trait.oreColor || 'var(--primary)'}40;">
                                <div class="forge-trait-ore" style="color: ${trait.oreColor || 'var(--primary)'};">
                                    <i class="fas ${getTraitIconClass(trait.oreId)}"></i> ${trait.oreName} (${trait.percentage.toFixed(1)}%)
                                </div>
                                <div class="forge-trait-desc">
                                    ${trait.description.replace(
                /([-+]?\d+(\.\d+)?)([+%s]*)/g,
                '<span class="scalable-value">$1<span class="scalable-symbol">$3</span></span>'
            )}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : ''}

        </div>
    `;

            modal.style.display = 'flex';
            modal.classList.add('show');
            if (window.innerWidth <= 480) {
                document.body.classList.add('modal-open');
            }
        }

        function setupForgeResultModal() {
            const modal = document.getElementById('forge-result-modal');
            const closeBtn = document.getElementById('forge-result-close');
            const closeResultBtn = document.getElementById('close-result-btn');
            const forgeAgainBtn = document.getElementById('forge-again-btn');

            function closeModal() {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    modal.style.display = 'none';
                    modal.classList.remove('show');
                    modal.style.animation = '';
                    document.body.classList.remove('modal-open');
                }, 300);
            }

            closeBtn.addEventListener('click', closeModal);
            closeResultBtn.addEventListener('click', closeModal);

            forgeAgainBtn.addEventListener('click', () => {
                closeModal();
                setTimeout(() => simulateForge(), 350);
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }

        const weaponColors = {
            '--primary': '#FF6600',
            '--primary-dark': '#cc5200',
            '--primary-light': 'rgba(255, 102, 0, 0.1)',
            '--primary-glow': 'rgba(255, 102, 0, 0.2)',
            '--text-secondary': '#ffa366',
            '--glow': '0 0 20px rgba(255, 102, 0, 0.4)'
        };

        const armorColors = {
            '--primary': '#19b9b9',
            '--primary-dark': '#0a6e6e',
            '--primary-light': 'rgba(9, 119, 119, 0.1)',
            '--primary-glow': 'rgba(13, 165, 165, 0.2)',
            '--text-secondary': '#6fdcdc',
            '--glow': '0 0 20px rgba(13, 165, 165, 0.4)'
        };

        function applyColorScheme(colors) {
            const root = document.documentElement;
            Object.keys(colors).forEach(key => {
                root.style.setProperty(key, colors[key]);
            });

            const logoBackground = document.getElementById('logo-background');
            if (currentMode === 'weapon') {
                logoBackground.style.filter = 'none';
            } else if (currentMode === 'armor') {
                logoBackground.style.filter = 'hue-rotate(151deg)';
            }
        }

        function setupFiltersDropdown() {
            filtersToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                filtersDropdown.classList.toggle('show');
            });

            document.addEventListener('click', (e) => {
                if (!filtersDropdown.contains(e.target) && !filtersToggle.contains(e.target)) {
                    filtersDropdown.classList.remove('show');
                }
            });

            filterOptions.forEach(option => {
                option.addEventListener('click', () => {
                    filterOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    activeFilter = option.dataset.filter;
                    filtersDropdown.classList.remove('show');
                    filtersToggle.innerHTML = `<i class="fas fa-filter"></i> ${option.textContent}`;
                    oreSearchInput.value = '';
                    currentSearchTerm = '';

                    renderOreInventory();
                    updateOreSlots();
                });
            });

            const initialActive = document.querySelector('.filter-option.active');
            if (initialActive) {
                filtersToggle.innerHTML = `<i class="fas fa-filter"></i> ${initialActive.textContent}`;
            }
        }

        function setupEventListeners() {
            weaponToggle.addEventListener('click', () => {
                currentMode = 'weapon';
                weaponToggle.classList.add('active');
                armorToggle.classList.remove('active');
                applyColorScheme(weaponColors);
                resetPreviewSelection();
                updateProbabilities();
                updateItemPreview();
                updateActiveTraits(oreMix.reduce((sum, item) => sum + item.count, 0));
            });

            armorToggle.addEventListener('click', () => {
                currentMode = 'armor';
                armorToggle.classList.add('active');
                weaponToggle.classList.remove('active');
                applyColorScheme(armorColors);
                resetPreviewSelection();
                updateProbabilities();
                updateItemPreview();
                updateActiveTraits(oreMix.reduce((sum, item) => sum + item.count, 0));
            });

            resetBtn.addEventListener('click', () => {
                oreMix = [];
                oreSearchInput.value = '';
                currentSearchTerm = '';
                resetPreviewSelection();
                renderOreInventory();
                updateOreSlots();
                updateProbabilities();
            });
            oreSearchInput.addEventListener('input', (e) => {
                currentSearchTerm = e.target.value;
                renderOreInventory();
                updateOreSlots();
            });

            const forgeBtn = document.getElementById('forge-btn');
            if (forgeBtn) {
                forgeBtn.addEventListener('click', () => {
                    isQuickCraft = false;
                    quickCraftTargetItem = null;
                    simulateForge();
                });
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>
